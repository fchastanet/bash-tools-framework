# Command configurator

This tool allows to generate a yaml file from php configuration files. I chose
php configuration as it is easier to inherit and compose configuration files.
The yaml generated will then be used by bash-compiler to interpret go templates,
this format is more suitable for this kind of process.

- [1. Json schema](#1-json-schema)
- [2. Build image and push](#2-build-image-and-push)
- [3. Build user image](#3-build-user-image)
- [4. Prod mode](#4-prod-mode)
  - [4.1. TODO create standalone binary](#41-todo-create-standalone-binary)
- [5. Dev mode](#5-dev-mode)
  - [5.1. Install composer dependencies](#51-install-composer-dependencies)
  - [5.2. Run converter](#52-run-converter)

## 1. Json schema

The yaml file produced conforms to the json schema
`command-configurator/schema/commands.schema.json`.

This json schema has been generated by
<https://extendsclass.com/json-schema-validator.html> from an existing yaml file
with some adaptations.

## 2. Build image and push

```bash
docker login
docker build -t scrasnups/frankenphp-composer-onbuild .
docker push
```

## 3. Build user image

```bash
docker build -f - --build-arg USER="${USER}" -t frankenphp-composer . <<EOF
FROM scrasnups/frankenphp-composer-onbuild

USER ${USER}
EOF
```

## 4. Prod mode

```bash
docker run --rm -v "${PWD}/config:/app/config" -v "${PWD}/config-generated:/app/config-generated" \
  -w /app frankenphp-composer php convertConfigFile.php
```

### 4.1. TODO create standalone binary

<https://frankenphp.dev/docs/embed/>

## 5. Dev mode

### 5.1. Install composer dependencies

```bash
docker run --rm -v "${PWD}:/app" -w /app frankenphp-composer composer install
```

### 5.2. Run converter

```bash
docker run --rm -v "${PWD}:/app" -w /app frankenphp-composer php convertConfigFile.php
```
