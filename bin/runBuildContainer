#!/usr/bin/env bash
###############################################################################
# GENERATED FACADE FROM https://github.com/fchastanet/bash-tools-framework/tree/master/src/_binaries/runBuildContainer.sh
# DO NOT EDIT IT
# @generated
###############################################################################
# shellcheck disable=SC2288,SC2034
# BIN_FILE=${FRAMEWORK_ROOT_DIR}/bin/runBuildContainer
# EMBED "${FRAMEWORK_ROOT_DIR}/bin/buildPushDockerImage" AS buildPushDockerImage
# VAR_RELATIVE_FRAMEWORK_DIR_TO_CURRENT_DIR=..
# FACADE

# ensure that no user aliases could interfere with
# commands used in this script
unalias -a || true
shopt -u expand_aliases

# shellcheck disable=SC2034
((failures = 0)) || true

# Bash will remember & return the highest exit code in a chain of pipes.
# This way you can catch the error inside pipes, e.g. mysqldump | gzip
set -o pipefail
set -o errexit

# Command Substitution can inherit errexit option since bash v4.4
shopt -s inherit_errexit || true

# a log is generated when a command fails
set -o errtrace

# use nullglob so that (file*.php) will return an empty array if no file matches the wildcard
shopt -s nullglob

# ensure regexp are interpreted without accentuated characters
export LC_ALL=POSIX

export TERM=xterm-256color

# avoid interactive install
export DEBIAN_FRONTEND=noninteractive
export DEBCONF_NONINTERACTIVE_SEEN=true

# store command arguments for later usage
# shellcheck disable=SC2034
declare -a BASH_FRAMEWORK_ARGV=("$@")
# shellcheck disable=SC2034
declare -a ORIGINAL_BASH_FRAMEWORK_ARGV=("$@")

# @see https://unix.stackexchange.com/a/386856
# shellcheck disable=SC2317
interruptManagement() {
  # restore SIGINT handler
  trap - INT
  # ensure that Ctrl-C is trapped by this script and not by sub process
  # report to the parent that we have indeed been interrupted
  kill -s INT "$$"
}
trap interruptManagement INT
SCRIPT_NAME=${0##*/}
REAL_SCRIPT_FILE="$(readlink -e "$(realpath "${BASH_SOURCE[0]}")")"
if [[ -n "${EMBED_CURRENT_DIR}" ]]; then
  CURRENT_DIR="${EMBED_CURRENT_DIR}"
else
  CURRENT_DIR="$(cd "$(readlink -e "${REAL_SCRIPT_FILE%/*}")" && pwd -P)"
fi

################################################
# Temp dir management
################################################

KEEP_TEMP_FILES="${KEEP_TEMP_FILES:-0}"
export KEEP_TEMP_FILES

# PERSISTENT_TMPDIR is not deleted by traps
PERSISTENT_TMPDIR="${TMPDIR:-/tmp}/bash-framework"
export PERSISTENT_TMPDIR
mkdir -p "${PERSISTENT_TMPDIR}"

# shellcheck disable=SC2034
TMPDIR="$(mktemp -d -p "${PERSISTENT_TMPDIR:-/tmp}" -t bash-framework-$$-XXXXXX)"
export TMPDIR

# temp dir cleaning
# shellcheck disable=SC2317
cleanOnExit() {
  if [[ "${KEEP_TEMP_FILES:-0}" = "1" ]]; then
    Log::displayInfo "KEEP_TEMP_FILES=1 temp files kept here '${TMPDIR}'"
  elif [[ -n "${TMPDIR+xxx}" ]]; then
    Log::displayDebug "KEEP_TEMP_FILES=0 removing temp files '${TMPDIR}'"
    rm -Rf "${TMPDIR:-/tmp/fake}" >/dev/null 2>&1
  fi
}
trap cleanOnExit EXIT HUP QUIT ABRT TERM

# @description concat each element of an array with a separator
# but wrapping text when line length is more than provided argument
# The algorithm will try not to cut the array element if can
#
# @arg $1 glue:String
# @arg $2 maxLineLength:int
# @arg $3 indentNextLine:int
# @arg $@ array:String[]
Array::wrap() {
  local glue="${1-}"
  local -i glueLength=0
  shift || true
  local -i maxLineLength=$1
  shift || true
  local -i indentNextLine=$1
  local indentStr=""
  if ((indentNextLine > 0)); then
    indentStr="$(head -c "${indentNextLine}" </dev/zero | tr '\0' " ")"
  fi
  local -i firstLine=1
  shift || true
  (($# != 0)) || return 0

  local arg

  # convert multi-line arg to several args
  local -a allArgs=()
  for arg in "$@"; do
    local line
    local IFS=$'\n'
    arg="$(echo -e "${arg}")"
    while read -r line; do
      if [[ -z "${line}" ]]; then
        allArgs+=($'\n')
      else
        allArgs+=("${line}")
      fi
    done <<<"${arg}"
  done
  set -- "${allArgs[@]}"

  local -i currentLineLength=0
  local needEcho="0"
  local arg="$1"
  local argNoAnsi
  local -i argNoAnsiLength=0

  while (($# > 0)); do
    argNoAnsi="$(echo "${arg%%*( )}" | Filters::removeAnsiCodes)"
    ((argNoAnsiLength = ${#argNoAnsi})) || true
    if (($# < 1 && argNoAnsiLength == 0)); then
      break
    fi
    if [[ "${arg}" = $'\n' ]]; then
      if [[ "${needEcho}" = "1" ]]; then
        needEcho="0"
      fi
      echo ""
      ((currentLineLength = 0)) || true
      ((glueLength = 0)) || true
      shift || return 0
      arg="$1"
    elif ((argNoAnsiLength < maxLineLength - currentLineLength - glueLength)); then
      # arg can be stored as a whole on current line
      if ((glueLength > 0)); then
        echo -e -n "${glue}"
        ((currentLineLength += glueLength))
      fi
      if ((currentLineLength == 0 && firstLine == 0)); then
        echo -n "${indentStr}"
      fi
      echo -e -n "${arg}" | sed 's/[\t ]*$//g'
      needEcho="1"
      ((currentLineLength += argNoAnsiLength))
      ((glueLength = ${#glue})) || true
      shift || return 0
      arg="$1"
    else
      if ((argNoAnsiLength >= (maxLineLength - indentNextLine))); then
        if ((currentLineLength == 0 && firstLine == 0)); then
          echo -n "${indentStr}"
          ((currentLineLength += indentNextLine))
        fi
        # arg can be stored on a whole line
        if ((glueLength > 0)); then
          echo -e -n "${glue}"
          ((currentLineLength += glueLength))
        fi
        local -i length
        ((length = maxLineLength - currentLineLength)) || true
        echo -e "${arg:0:${length}}" | sed 's/[\t ]*$//g'
        ((currentLineLength = 0)) || true
        ((glueLength = 0)) || true
        arg="${arg:${length}}"
        needEcho="0"
      else
        # arg cannot be stored on a whole line, so we add it on next line as a whole
        echo
        echo -e -n "${indentStr}${arg}" | sed 's/[\t ]*$//g'
        ((glueLength = ${#glue})) || true
        ((currentLineLength = argNoAnsiLength))
        arg="" # allows to go to next arg
        needEcho="1"
      fi
      if [[ -z "${arg}" ]]; then
        shift || return 0
        arg="$1"
      fi
    fi
    ((firstLine = 0)) || true
  done
  if [[ "${needEcho}" = "1" ]]; then
    echo
  fi
}

#set -x
#Array::wrap ":" 40 0 "Lorem ipsum dolor sit amet," "consectetur adipiscing elit." "Curabitur ac elit id massa" "condimentum finibus."

# @description convert base64 encoded back to target file
# if target file is executable prepend dir of target
# file to PATH to make binary available everywhere
# it is advised to include in the path of the target file
# the md5sum of the binFile
#
# @arg $1 targetFile:String the file to write
# @arg $2 binFileBase64:String the base64 encoded file
# @arg $3 fileMode:String the chmod to set on the file
# @set PATH String prepend target embedded file binary directory to PATH variable if binary executable
Compiler::Embed::extractFileFromBase64() {
  local targetFile="$1"
  local binFileBase64="$2"
  local fileMode="${3:-+x}"

  if [[ ! -f "${targetFile}" ]]; then
    mkdir -p "$(dirname "${targetFile}")"
    base64 -d >"${targetFile}" <<<"${binFileBase64}"
    chmod "${fileMode}" "${targetFile}"
  fi

  if [[ -x "${targetFile}" ]]; then
    Env::pathPrepend "$(dirname "${targetFile}")"
  fi
}

# @description ensure env files are loaded
# @arg $@ list of default files to load at the end
# @exitcode 1 if one of env files fails to load
# @stderr diagnostics information is displayed
# shellcheck disable=SC2120
Env::requireLoad() {
  local -a defaultFiles=("$@")
  # get list of possible config files
  local -a configFiles=()
  if [[ -n "${BASH_FRAMEWORK_ENV_FILES[0]+1}" ]]; then
    # BASH_FRAMEWORK_ENV_FILES is an array
    configFiles+=("${BASH_FRAMEWORK_ENV_FILES[@]}")
  fi
  if [[ -f "${FRAMEWORK_ROOT_DIR}/.framework-config" ]]; then
    configFiles+=("${FRAMEWORK_ROOT_DIR}/.framework-config")
  fi
  if [[ -f "$(pwd)/.framework-config" ]]; then
    configFiles+=("$(pwd)/.framework-config")
  fi
  if [[ -n "${optionBashFrameworkConfig}" && -f "${optionBashFrameworkConfig}" ]]; then
    # shellcheck disable=SC2034
    configFiles+=("${optionBashFrameworkConfig}")
  fi
  configFiles+=("${optionEnvFiles[@]}")
  configFiles+=("${defaultFiles[@]}")

  for file in "${configFiles[@]}"; do
    # shellcheck source=/.framework-config
    source "${file}" || {
      Log::displayError "while loading config file: ${file}"
      return 1
    }
  done
}

# @description Log namespace provides 2 kind of functions
# - Log::display* allows to display given message with
#   given display level
# - Log::log* allows to log given message with
#   given log level
# Log::display* functions automatically log the message too
# @see Env::requireLoad to load the display and log level from .env file

# @description log level off
export __LEVEL_OFF=0
# @description log level error
export __LEVEL_ERROR=1
# @description log level warning
export __LEVEL_WARNING=2
# @description log level info
export __LEVEL_INFO=3
# @description log level success
export __LEVEL_SUCCESS=3
# @description log level debug
export __LEVEL_DEBUG=4

# @description verbose level off
export __VERBOSE_LEVEL_OFF=0
# @description verbose level info
export __VERBOSE_LEVEL_INFO=1
# @description verbose level info
export __VERBOSE_LEVEL_DEBUG=2
# @description verbose level info
export __VERBOSE_LEVEL_TRACE=3

# @description Display message using debug color (grey)
# @arg $1 message:String the message to display
Log::displayDebug() {
  if ((BASH_FRAMEWORK_DISPLAY_LEVEL >= __LEVEL_DEBUG)); then
    echo -e "${__DEBUG_COLOR}DEBUG   - ${1}${__RESET_COLOR}" >&2
  fi
  Log::logDebug "$1"
}

# @description Display message using error color (red)
# @arg $1 message:String the message to display
Log::displayError() {
  if ((BASH_FRAMEWORK_DISPLAY_LEVEL >= __LEVEL_ERROR)); then
    echo -e "${__ERROR_COLOR}ERROR   - ${1}${__RESET_COLOR}" >&2
  fi
  Log::logError "$1"
}

# @description Display message using info color (bg light blue/fg white)
# @arg $1 message:String the message to display
Log::displayInfo() {
  local type="${2:-INFO}"
  if ((BASH_FRAMEWORK_DISPLAY_LEVEL >= __LEVEL_INFO)); then
    echo -e "${__INFO_COLOR}${type}    - ${1}${__RESET_COLOR}" >&2
  fi
  Log::logInfo "$1" "${type}"
}

# @description Display message using warning color (yellow)
# @arg $1 message:String the message to display
Log::displayWarning() {
  if ((BASH_FRAMEWORK_DISPLAY_LEVEL >= __LEVEL_WARNING)); then
    echo -e "${__WARNING_COLOR}WARN    - ${1}${__RESET_COLOR}" >&2
  fi
  Log::logWarning "$1"
}

# @description Display message using error color (red) and exit immediately with error status 1
# @arg $1 message:String the message to display
Log::fatal() {
  echo -e "${__ERROR_COLOR}FATAL   - ${1}${__RESET_COLOR}" >&2
  Log::logFatal "$1"
  exit 1
}

# @description activate or not Log::display* and Log::log* functions
# based on BASH_FRAMEWORK_DISPLAY_LEVEL and BASH_FRAMEWORK_LOG_LEVEL
# environment variables loaded by Env::requireLoad
# try to create log file and rotate it if necessary
# @noargs
# @set BASH_FRAMEWORK_LOG_LEVEL int to OFF level if BASH_FRAMEWORK_LOG_FILE is empty or not writable
# @env BASH_FRAMEWORK_DISPLAY_LEVEL int
# @env BASH_FRAMEWORK_LOG_LEVEL int
# @env BASH_FRAMEWORK_LOG_FILE String
# @env BASH_FRAMEWORK_LOG_FILE_MAX_ROTATION int do log rotation if > 0
# @exitcode 0 always successful
# @stderr diagnostics information about log file is displayed
# @require Env::requireLoad
# @require UI::requireTheme
Log::requireLoad() {
  if [[ -z "${BASH_FRAMEWORK_LOG_FILE:-}" ]]; then
    BASH_FRAMEWORK_LOG_LEVEL=${__LEVEL_OFF}
    export BASH_FRAMEWORK_LOG_LEVEL
  fi

  if ((BASH_FRAMEWORK_LOG_LEVEL > __LEVEL_OFF)); then
    if [[ ! -f "${BASH_FRAMEWORK_LOG_FILE}" ]]; then
      if
        ! mkdir -p "$(dirname "${BASH_FRAMEWORK_LOG_FILE}")" 2>/dev/null ||
          ! touch --no-create "${BASH_FRAMEWORK_LOG_FILE}" 2>/dev/null
      then
        BASH_FRAMEWORK_LOG_LEVEL=${__LEVEL_OFF}
        echo -e "${__ERROR_COLOR}ERROR   - File ${BASH_FRAMEWORK_LOG_FILE} is not writable${__RESET_COLOR}" >&2
      fi
    elif [[ ! -w "${BASH_FRAMEWORK_LOG_FILE}" ]]; then
      BASH_FRAMEWORK_LOG_LEVEL=${__LEVEL_OFF}
      echo -e "${__ERROR_COLOR}ERROR   - File ${BASH_FRAMEWORK_LOG_FILE} is not writable${__RESET_COLOR}" >&2
    fi

  fi

  if ((BASH_FRAMEWORK_LOG_LEVEL > __LEVEL_OFF)); then
    # will always be created even if not in info level
    Log::logMessage "INFO" "Logging to file ${BASH_FRAMEWORK_LOG_FILE} - Log level ${BASH_FRAMEWORK_LOG_LEVEL}"
    if ((BASH_FRAMEWORK_LOG_FILE_MAX_ROTATION > 0)); then
      Log::rotate "${BASH_FRAMEWORK_LOG_FILE}" "${BASH_FRAMEWORK_LOG_FILE_MAX_ROTATION}"
    fi
  fi
}

# @description draw a line with the character passed in parameter repeated depending on terminal width
# @arg $1 character:String character to use as separator (default value #)
UI::drawLine() {
  local character="${1:-#}"
  printf '%*s\n' "${COLUMNS:-$([[ -t 0 ]] && tput cols || echo)}" '' | tr ' ' "${character}"
}

# @description load colors theme constants
# @warning if tty not opened, noColor theme will be chosen
# @arg $1 theme:String the theme to use (default, noColor)
# @arg $@ args:String[]
# @set __ERROR_COLOR String indicate error status
# @set __INFO_COLOR String indicate info status
# @set __SUCCESS_COLOR String indicate success status
# @set __WARNING_COLOR String indicate warning status
# @set __SKIPPED_COLOR String indicate skipped status
# @set __DEBUG_COLOR String indicate debug status
# @set __HELP_COLOR String indicate help status
# @set __TEST_COLOR String not used
# @set __TEST_ERROR_COLOR String not used
# @set __HELP_TITLE_COLOR String used to display help title in help strings
# @set __HELP_OPTION_COLOR String used to display highlight options in help strings
#
# @set __RESET_COLOR String reset default color
#
# @set __HELP_EXAMPLE String to remove
# @set __HELP_TITLE String to remove
# @set __HELP_NORMAL String to remove
# shellcheck disable=SC2034
UI::theme() {
  local theme="${1-default}"
  if [[ ! "${theme}" =~ -force$ ]] && ! Assert::tty; then
    theme="noColor"
  fi
  case "${theme}" in
    default | default-force)
      theme="default"
      ;;
    noColor) ;;
    *)
      Log::fatal "invalid theme provided"
      ;;
  esac
  if [[ "${theme}" = "default" ]]; then
    BASH_FRAMEWORK_THEME="default"
    # check colors applicable https://misc.flogisoft.com/bash/tip_colors_and_formatting
    __ERROR_COLOR='\e[31m'         # Red
    __INFO_COLOR='\e[44m'          # white on lightBlue
    __SUCCESS_COLOR='\e[32m'       # Green
    __WARNING_COLOR='\e[33m'       # Yellow
    __SKIPPED_COLOR='\e[33m'       # Yellow
    __DEBUG_COLOR='\e[37m'         # Grey
    __HELP_COLOR='\e[7;49;33m'     # Black on Gold
    __TEST_COLOR='\e[100m'         # Light magenta
    __TEST_ERROR_COLOR='\e[41m'    # white on red
    __HELP_TITLE_COLOR="\e[1;37m"  # Bold
    __HELP_OPTION_COLOR="\e[1;34m" # Blue
    # Internal: reset color
    __RESET_COLOR='\e[0m' # Reset Color
    # shellcheck disable=SC2155,SC2034
    __HELP_EXAMPLE="$(echo -e "\e[2;97m")"
    # shellcheck disable=SC2155,SC2034
    __HELP_TITLE="$(echo -e "\e[1;37m")"
    # shellcheck disable=SC2155,SC2034
    __HELP_NORMAL="$(echo -e "\033[0m")"
  else
    BASH_FRAMEWORK_THEME="noColor"
    # check colors applicable https://misc.flogisoft.com/bash/tip_colors_and_formatting
    __ERROR_COLOR=''
    __INFO_COLOR=''
    __SUCCESS_COLOR=''
    __WARNING_COLOR=''
    __SKIPPED_COLOR=''
    __DEBUG_COLOR=''
    __HELP_COLOR=''
    __TEST_COLOR=''
    __TEST_ERROR_COLOR=''
    __HELP_TITLE_COLOR=''
    __HELP_OPTION_COLOR=''
    # Internal: reset color
    __RESET_COLOR=''
    __HELP_EXAMPLE=''
    __HELP_TITLE=''
    __HELP_NORMAL=''
  fi
}

# @description ensure COMMAND_BIN_DIR env var is set
# and PATH correctly prepared
# @noargs
# @set COMMAND_BIN_DIR string the directory where to find this command
# @set PATH string add directory where to find this command binary
Compiler::Facade::requireCommandBinDir() {
  COMMAND_BIN_DIR="${CURRENT_DIR}"
  Env::pathPrepend "${COMMAND_BIN_DIR}"
}

# @description check if tty (interactive mode) is active
# @noargs
# @exitcode 1 if tty not active
# @env NON_INTERACTIVE if 1 consider as not interactive even if environment is interactive
# @env INTERACTIVE if 1 consider as interactive even if environment is not interactive
# @stderr diagnostic information + help if second argument is provided
Assert::tty() {
  if [[ "${NON_INTERACTIVE:-0}" = "1" ]]; then
    return 1
  fi
  if [[ "${INTERACTIVE:-0}" = "1" ]]; then
    return 0
  fi
  [[ -t 1 || -t 2 ]]
}

# @description prepend directories to the PATH environment variable
# @arg $@ args:String[] list of directories to prepend
# @set PATH update PATH with the directories prepended
Env::pathPrepend() {
  local arg
  for arg in "$@"; do
    if [[ -d "${arg}" && ":${PATH}:" != *":${arg}:"* ]]; then
      PATH="$(realpath "${arg}"):${PATH}"
    fi
  done
}

# @description remove ansi codes from input or files given as argument
# @arg $@ files:String[] the files to filter
# @exitcode * if one of the filter command fails
# @stdin you can use stdin as alternative to files argument
# @stdout the filtered content
# @see https://en.wikipedia.org/wiki/ANSI_escape_code
# shellcheck disable=SC2120
Filters::removeAnsiCodes() {
  # cspell:disable
  sed -E 's/\x1b\[[0-9;]*[mGKHF]//g' "$@"
  # cspell:enable
}

# @description log message to file
# @arg $1 message:String the message to display
Log::logDebug() {
  if ((BASH_FRAMEWORK_LOG_LEVEL >= __LEVEL_DEBUG)); then
    Log::logMessage "${2:-DEBUG}" "$1"
  fi
}

# @description log message to file
# @arg $1 message:String the message to display
Log::logError() {
  if ((BASH_FRAMEWORK_LOG_LEVEL >= __LEVEL_ERROR)); then
    Log::logMessage "${2:-ERROR}" "$1"
  fi
}

# @description log message to file
# @arg $1 message:String the message to display
Log::logFatal() {
  Log::logMessage "${2:-FATAL}" "$1"
}

# @description log message to file
# @arg $1 message:String the message to display
Log::logInfo() {
  if ((BASH_FRAMEWORK_LOG_LEVEL >= __LEVEL_INFO)); then
    Log::logMessage "${2:-INFO}" "$1"
  fi
}

# @description Internal: common log message
# @example text
#   [date]|[levelMsg]|message
#
# @example text
#   2020-01-19 19:20:21|ERROR  |log error
#   2020-01-19 19:20:21|SKIPPED|log skipped
#
# @arg $1 levelMsg:String message's level description (eg: STATUS, ERROR, ...)
# @arg $2 msg:String the message to display
# @env BASH_FRAMEWORK_LOG_FILE String log file to use, do nothing if empty
# @env BASH_FRAMEWORK_LOG_LEVEL int log level log only if > OFF or fatal messages
# @stderr diagnostics information is displayed
# @require Env::requireLoad
# @require Log::requireLoad
Log::logMessage() {
  local levelMsg="$1"
  local msg="$2"
  local date

  if [[ -n "${BASH_FRAMEWORK_LOG_FILE}" ]] && ((BASH_FRAMEWORK_LOG_LEVEL > __LEVEL_OFF)); then
    date="$(date '+%Y-%m-%d %H:%M:%S')"
    touch "${BASH_FRAMEWORK_LOG_FILE}"
    printf "%s|%7s|%s\n" "${date}" "${levelMsg}" "${msg}" >>"${BASH_FRAMEWORK_LOG_FILE}"
  fi
}

# @description log message to file
# @arg $1 message:String the message to display
Log::logWarning() {
  if ((BASH_FRAMEWORK_LOG_LEVEL >= __LEVEL_WARNING)); then
    Log::logMessage "${2:-WARNING}" "$1"
  fi
}

# @description To be called before logging in the log file
# @arg $1 file:string log file name
# @arg $2 maxLogFilesCount:int maximum number of log files
Log::rotate() {
  local file="$1"
  local maxLogFilesCount="${2:-5}"

  if [[ ! -f "${file}" ]]; then
    Log::displaySkipped "Log file ${file} doesn't exist yet"
    return 0
  fi
  for i in $(seq $((maxLogFilesCount - 1)) -1 1); do
    Log::displayInfo "Log rotation ${file}.${i} to ${file}.$((i + 1))"
    mv "${file}."{"${i}","$((i + 1))"} &>/dev/null || true
  done
  if cp "${file}" "${file}.1" &>/dev/null; then
    echo >"${file}" # reset log file
    Log::displayInfo "Log rotation ${file} to ${file}.1"
  fi
}

# @description load color theme
# @noargs
# @env BASH_FRAMEWORK_THEME String theme to use
# @exitcode 0 always successful
UI::requireTheme() {
  UI::theme "${BASH_FRAMEWORK_THEME-default}"
}

# @description Display message using skip color (yellow)
# @arg $1 message:String the message to display
Log::displaySkipped() {
  if ((BASH_FRAMEWORK_DISPLAY_LEVEL >= __LEVEL_INFO)); then
    echo -e "${__SKIPPED_COLOR}SKIPPED - ${1}${__RESET_COLOR}" >&2
  fi
  Log::logSkipped "$1"
}

# @description log message to file
# @arg $1 message:String the message to display
Log::logSkipped() {
  if ((BASH_FRAMEWORK_LOG_LEVEL >= __LEVEL_INFO)); then
    Log::logMessage "${2:-SKIPPED}" "$1"
  fi
}

# FUNCTIONS

Compiler::Embed::extractFileFromBase64 "${PERSISTENT_TMPDIR:-/tmp}/c99752b27d9c27add2df540725abcf0e/buildPushDockerImage" "IyEvdXNyL2Jpbi9lbnYgYmFzaAojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMgR0VORVJBVEVEIEZBQ0FERSBGUk9NIGh0dHBzOi8vZ2l0aHViLmNvbS9mY2hhc3RhbmV0L2Jhc2gtdG9vbHMtZnJhbWV3b3JrL3RyZWUvbWFzdGVyL3NyYy9fYmluYXJpZXMvYnVpbGRQdXNoRG9ja2VySW1hZ2Uuc2gKIyBETyBOT1QgRURJVCBJVAojIEBnZW5lcmF0ZWQKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIyODgsU0MyMDM0CiMgQklOX0ZJTEU9JHtGUkFNRVdPUktfUk9PVF9ESVJ9L2Jpbi9idWlsZFB1c2hEb2NrZXJJbWFnZQojIFZBUl9SRUxBVElWRV9GUkFNRVdPUktfRElSX1RPX0NVUlJFTlRfRElSPS4uCiMgRkFDQURFCgojIGVuc3VyZSB0aGF0IG5vIHVzZXIgYWxpYXNlcyBjb3VsZCBpbnRlcmZlcmUgd2l0aAojIGNvbW1hbmRzIHVzZWQgaW4gdGhpcyBzY3JpcHQKdW5hbGlhcyAtYSB8fCB0cnVlCnNob3B0IC11IGV4cGFuZF9hbGlhc2VzCgojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKKChmYWlsdXJlcyA9IDApKSB8fCB0cnVlCgojIEJhc2ggd2lsbCByZW1lbWJlciAmIHJldHVybiB0aGUgaGlnaGVzdCBleGl0IGNvZGUgaW4gYSBjaGFpbiBvZiBwaXBlcy4KIyBUaGlzIHdheSB5b3UgY2FuIGNhdGNoIHRoZSBlcnJvciBpbnNpZGUgcGlwZXMsIGUuZy4gbXlzcWxkdW1wIHwgZ3ppcApzZXQgLW8gcGlwZWZhaWwKc2V0IC1vIGVycmV4aXQKCiMgQ29tbWFuZCBTdWJzdGl0dXRpb24gY2FuIGluaGVyaXQgZXJyZXhpdCBvcHRpb24gc2luY2UgYmFzaCB2NC40CnNob3B0IC1zIGluaGVyaXRfZXJyZXhpdCB8fCB0cnVlCgojIGEgbG9nIGlzIGdlbmVyYXRlZCB3aGVuIGEgY29tbWFuZCBmYWlscwpzZXQgLW8gZXJydHJhY2UKCiMgdXNlIG51bGxnbG9iIHNvIHRoYXQgKGZpbGUqLnBocCkgd2lsbCByZXR1cm4gYW4gZW1wdHkgYXJyYXkgaWYgbm8gZmlsZSBtYXRjaGVzIHRoZSB3aWxkY2FyZApzaG9wdCAtcyBudWxsZ2xvYgoKIyBlbnN1cmUgcmVnZXhwIGFyZSBpbnRlcnByZXRlZCB3aXRob3V0IGFjY2VudHVhdGVkIGNoYXJhY3RlcnMKZXhwb3J0IExDX0FMTD1QT1NJWAoKZXhwb3J0IFRFUk09eHRlcm0tMjU2Y29sb3IKCiMgYXZvaWQgaW50ZXJhY3RpdmUgaW5zdGFsbApleHBvcnQgREVCSUFOX0ZST05URU5EPW5vbmludGVyYWN0aXZlCmV4cG9ydCBERUJDT05GX05PTklOVEVSQUNUSVZFX1NFRU49dHJ1ZQoKIyBzdG9yZSBjb21tYW5kIGFyZ3VtZW50cyBmb3IgbGF0ZXIgdXNhZ2UKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CmRlY2xhcmUgLWEgQkFTSF9GUkFNRVdPUktfQVJHVj0oIiRAIikKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CmRlY2xhcmUgLWEgT1JJR0lOQUxfQkFTSF9GUkFNRVdPUktfQVJHVj0oIiRAIikKCiMgQHNlZSBodHRwczovL3VuaXguc3RhY2tleGNoYW5nZS5jb20vYS8zODY4NTYKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3CmludGVycnVwdE1hbmFnZW1lbnQoKSB7CiAgIyByZXN0b3JlIFNJR0lOVCBoYW5kbGVyCiAgdHJhcCAtIElOVAogICMgZW5zdXJlIHRoYXQgQ3RybC1DIGlzIHRyYXBwZWQgYnkgdGhpcyBzY3JpcHQgYW5kIG5vdCBieSBzdWIgcHJvY2VzcwogICMgcmVwb3J0IHRvIHRoZSBwYXJlbnQgdGhhdCB3ZSBoYXZlIGluZGVlZCBiZWVuIGludGVycnVwdGVkCiAga2lsbCAtcyBJTlQgIiQkIgp9CnRyYXAgaW50ZXJydXB0TWFuYWdlbWVudCBJTlQKU0NSSVBUX05BTUU9JHswIyMqL30KUkVBTF9TQ1JJUFRfRklMRT0iJChyZWFkbGluayAtZSAiJChyZWFscGF0aCAiJHtCQVNIX1NPVVJDRVswXX0iKSIpIgppZiBbWyAtbiAiJHtFTUJFRF9DVVJSRU5UX0RJUn0iIF1dOyB0aGVuCiAgQ1VSUkVOVF9ESVI9IiR7RU1CRURfQ1VSUkVOVF9ESVJ9IgplbHNlCiAgQ1VSUkVOVF9ESVI9IiQoY2QgIiQocmVhZGxpbmsgLWUgIiR7UkVBTF9TQ1JJUFRfRklMRSUvKn0iKSIgJiYgcHdkIC1QKSIKZmkKCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIFRlbXAgZGlyIG1hbmFnZW1lbnQKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCgpLRUVQX1RFTVBfRklMRVM9IiR7S0VFUF9URU1QX0ZJTEVTOi0wfSIKZXhwb3J0IEtFRVBfVEVNUF9GSUxFUwoKIyBQRVJTSVNURU5UX1RNUERJUiBpcyBub3QgZGVsZXRlZCBieSB0cmFwcwpQRVJTSVNURU5UX1RNUERJUj0iJHtUTVBESVI6LS90bXB9L2Jhc2gtZnJhbWV3b3JrIgpleHBvcnQgUEVSU0lTVEVOVF9UTVBESVIKbWtkaXIgLXAgIiR7UEVSU0lTVEVOVF9UTVBESVJ9IgoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0ClRNUERJUj0iJChta3RlbXAgLWQgLXAgIiR7UEVSU0lTVEVOVF9UTVBESVI6LS90bXB9IiAtdCBiYXNoLWZyYW1ld29yay0kJC1YWFhYWFgpIgpleHBvcnQgVE1QRElSCgojIHRlbXAgZGlyIGNsZWFuaW5nCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNwpjbGVhbk9uRXhpdCgpIHsKICBpZiBbWyAiJHtLRUVQX1RFTVBfRklMRVM6LTB9IiA9ICIxIiBdXTsgdGhlbgogICAgTG9nOjpkaXNwbGF5SW5mbyAiS0VFUF9URU1QX0ZJTEVTPTEgdGVtcCBmaWxlcyBrZXB0IGhlcmUgJyR7VE1QRElSfSciCiAgZWxpZiBbWyAtbiAiJHtUTVBESVIreHh4fSIgXV07IHRoZW4KICAgIExvZzo6ZGlzcGxheURlYnVnICJLRUVQX1RFTVBfRklMRVM9MCByZW1vdmluZyB0ZW1wIGZpbGVzICcke1RNUERJUn0nIgogICAgcm0gLVJmICIke1RNUERJUjotL3RtcC9mYWtlfSIgPi9kZXYvbnVsbCAyPiYxCiAgZmkKfQp0cmFwIGNsZWFuT25FeGl0IEVYSVQgSFVQIFFVSVQgQUJSVCBURVJNCgojIEBkZXNjcmlwdGlvbiBjb25jYXQgZWFjaCBlbGVtZW50IG9mIGFuIGFycmF5IHdpdGggYSBzZXBhcmF0b3IKIyBidXQgd3JhcHBpbmcgdGV4dCB3aGVuIGxpbmUgbGVuZ3RoIGlzIG1vcmUgdGhhbiBwcm92aWRlZCBhcmd1bWVudAojIFRoZSBhbGdvcml0aG0gd2lsbCB0cnkgbm90IHRvIGN1dCB0aGUgYXJyYXkgZWxlbWVudCBpZiBjYW4KIwojIEBhcmcgJDEgZ2x1ZTpTdHJpbmcKIyBAYXJnICQyIG1heExpbmVMZW5ndGg6aW50CiMgQGFyZyAkMyBpbmRlbnROZXh0TGluZTppbnQKIyBAYXJnICRAIGFycmF5OlN0cmluZ1tdCkFycmF5Ojp3cmFwKCkgewogIGxvY2FsIGdsdWU9IiR7MS19IgogIGxvY2FsIC1pIGdsdWVMZW5ndGg9MAogIHNoaWZ0IHx8IHRydWUKICBsb2NhbCAtaSBtYXhMaW5lTGVuZ3RoPSQxCiAgc2hpZnQgfHwgdHJ1ZQogIGxvY2FsIC1pIGluZGVudE5leHRMaW5lPSQxCiAgbG9jYWwgaW5kZW50U3RyPSIiCiAgaWYgKChpbmRlbnROZXh0TGluZSA+IDApKTsgdGhlbgogICAgaW5kZW50U3RyPSIkKGhlYWQgLWMgIiR7aW5kZW50TmV4dExpbmV9IiA8L2Rldi96ZXJvIHwgdHIgJ1wwJyAiICIpIgogIGZpCiAgbG9jYWwgLWkgZmlyc3RMaW5lPTEKICBzaGlmdCB8fCB0cnVlCiAgKCgkIyAhPSAwKSkgfHwgcmV0dXJuIDAKCiAgbG9jYWwgYXJnCgogICMgY29udmVydCBtdWx0aS1saW5lIGFyZyB0byBzZXZlcmFsIGFyZ3MKICBsb2NhbCAtYSBhbGxBcmdzPSgpCiAgZm9yIGFyZyBpbiAiJEAiOyBkbwogICAgbG9jYWwgbGluZQogICAgbG9jYWwgSUZTPSQnXG4nCiAgICBhcmc9IiQoZWNobyAtZSAiJHthcmd9IikiCiAgICB3aGlsZSByZWFkIC1yIGxpbmU7IGRvCiAgICAgIGlmIFtbIC16ICIke2xpbmV9IiBdXTsgdGhlbgogICAgICAgIGFsbEFyZ3MrPSgkJ1xuJykKICAgICAgZWxzZQogICAgICAgIGFsbEFyZ3MrPSgiJHtsaW5lfSIpCiAgICAgIGZpCiAgICBkb25lIDw8PCIke2FyZ30iCiAgZG9uZQogIHNldCAtLSAiJHthbGxBcmdzW0BdfSIKCiAgbG9jYWwgLWkgY3VycmVudExpbmVMZW5ndGg9MAogIGxvY2FsIG5lZWRFY2hvPSIwIgogIGxvY2FsIGFyZz0iJDEiCiAgbG9jYWwgYXJnTm9BbnNpCiAgbG9jYWwgLWkgYXJnTm9BbnNpTGVuZ3RoPTAKCiAgd2hpbGUgKCgkIyA+IDApKTsgZG8KICAgIGFyZ05vQW5zaT0iJChlY2hvICIke2FyZyUlKiggKX0iIHwgRmlsdGVyczo6cmVtb3ZlQW5zaUNvZGVzKSIKICAgICgoYXJnTm9BbnNpTGVuZ3RoID0gJHsjYXJnTm9BbnNpfSkpIHx8IHRydWUKICAgIGlmICgoJCMgPCAxICYmIGFyZ05vQW5zaUxlbmd0aCA9PSAwKSk7IHRoZW4KICAgICAgYnJlYWsKICAgIGZpCiAgICBpZiBbWyAiJHthcmd9IiA9ICQnXG4nIF1dOyB0aGVuCiAgICAgIGlmIFtbICIke25lZWRFY2hvfSIgPSAiMSIgXV07IHRoZW4KICAgICAgICBuZWVkRWNobz0iMCIKICAgICAgZmkKICAgICAgZWNobyAiIgogICAgICAoKGN1cnJlbnRMaW5lTGVuZ3RoID0gMCkpIHx8IHRydWUKICAgICAgKChnbHVlTGVuZ3RoID0gMCkpIHx8IHRydWUKICAgICAgc2hpZnQgfHwgcmV0dXJuIDAKICAgICAgYXJnPSIkMSIKICAgIGVsaWYgKChhcmdOb0Fuc2lMZW5ndGggPCBtYXhMaW5lTGVuZ3RoIC0gY3VycmVudExpbmVMZW5ndGggLSBnbHVlTGVuZ3RoKSk7IHRoZW4KICAgICAgIyBhcmcgY2FuIGJlIHN0b3JlZCBhcyBhIHdob2xlIG9uIGN1cnJlbnQgbGluZQogICAgICBpZiAoKGdsdWVMZW5ndGggPiAwKSk7IHRoZW4KICAgICAgICBlY2hvIC1lIC1uICIke2dsdWV9IgogICAgICAgICgoY3VycmVudExpbmVMZW5ndGggKz0gZ2x1ZUxlbmd0aCkpCiAgICAgIGZpCiAgICAgIGlmICgoY3VycmVudExpbmVMZW5ndGggPT0gMCAmJiBmaXJzdExpbmUgPT0gMCkpOyB0aGVuCiAgICAgICAgZWNobyAtbiAiJHtpbmRlbnRTdHJ9IgogICAgICBmaQogICAgICBlY2hvIC1lIC1uICIke2FyZ30iIHwgc2VkICdzL1tcdCBdKiQvL2cnCiAgICAgIG5lZWRFY2hvPSIxIgogICAgICAoKGN1cnJlbnRMaW5lTGVuZ3RoICs9IGFyZ05vQW5zaUxlbmd0aCkpCiAgICAgICgoZ2x1ZUxlbmd0aCA9ICR7I2dsdWV9KSkgfHwgdHJ1ZQogICAgICBzaGlmdCB8fCByZXR1cm4gMAogICAgICBhcmc9IiQxIgogICAgZWxzZQogICAgICBpZiAoKGFyZ05vQW5zaUxlbmd0aCA+PSAobWF4TGluZUxlbmd0aCAtIGluZGVudE5leHRMaW5lKSkpOyB0aGVuCiAgICAgICAgaWYgKChjdXJyZW50TGluZUxlbmd0aCA9PSAwICYmIGZpcnN0TGluZSA9PSAwKSk7IHRoZW4KICAgICAgICAgIGVjaG8gLW4gIiR7aW5kZW50U3RyfSIKICAgICAgICAgICgoY3VycmVudExpbmVMZW5ndGggKz0gaW5kZW50TmV4dExpbmUpKQogICAgICAgIGZpCiAgICAgICAgIyBhcmcgY2FuIGJlIHN0b3JlZCBvbiBhIHdob2xlIGxpbmUKICAgICAgICBpZiAoKGdsdWVMZW5ndGggPiAwKSk7IHRoZW4KICAgICAgICAgIGVjaG8gLWUgLW4gIiR7Z2x1ZX0iCiAgICAgICAgICAoKGN1cnJlbnRMaW5lTGVuZ3RoICs9IGdsdWVMZW5ndGgpKQogICAgICAgIGZpCiAgICAgICAgbG9jYWwgLWkgbGVuZ3RoCiAgICAgICAgKChsZW5ndGggPSBtYXhMaW5lTGVuZ3RoIC0gY3VycmVudExpbmVMZW5ndGgpKSB8fCB0cnVlCiAgICAgICAgZWNobyAtZSAiJHthcmc6MDoke2xlbmd0aH19IiB8IHNlZCAncy9bXHQgXSokLy9nJwogICAgICAgICgoY3VycmVudExpbmVMZW5ndGggPSAwKSkgfHwgdHJ1ZQogICAgICAgICgoZ2x1ZUxlbmd0aCA9IDApKSB8fCB0cnVlCiAgICAgICAgYXJnPSIke2FyZzoke2xlbmd0aH19IgogICAgICAgIG5lZWRFY2hvPSIwIgogICAgICBlbHNlCiAgICAgICAgIyBhcmcgY2Fubm90IGJlIHN0b3JlZCBvbiBhIHdob2xlIGxpbmUsIHNvIHdlIGFkZCBpdCBvbiBuZXh0IGxpbmUgYXMgYSB3aG9sZQogICAgICAgIGVjaG8KICAgICAgICBlY2hvIC1lIC1uICIke2luZGVudFN0cn0ke2FyZ30iIHwgc2VkICdzL1tcdCBdKiQvL2cnCiAgICAgICAgKChnbHVlTGVuZ3RoID0gJHsjZ2x1ZX0pKSB8fCB0cnVlCiAgICAgICAgKChjdXJyZW50TGluZUxlbmd0aCA9IGFyZ05vQW5zaUxlbmd0aCkpCiAgICAgICAgYXJnPSIiICMgYWxsb3dzIHRvIGdvIHRvIG5leHQgYXJnCiAgICAgICAgbmVlZEVjaG89IjEiCiAgICAgIGZpCiAgICAgIGlmIFtbIC16ICIke2FyZ30iIF1dOyB0aGVuCiAgICAgICAgc2hpZnQgfHwgcmV0dXJuIDAKICAgICAgICBhcmc9IiQxIgogICAgICBmaQogICAgZmkKICAgICgoZmlyc3RMaW5lID0gMCkpIHx8IHRydWUKICBkb25lCiAgaWYgW1sgIiR7bmVlZEVjaG99IiA9ICIxIiBdXTsgdGhlbgogICAgZWNobwogIGZpCn0KCiNzZXQgLXgKI0FycmF5Ojp3cmFwICI6IiA0MCAwICJMb3JlbSBpcHN1bSBkb2xvciBzaXQgYW1ldCwiICJjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQuIiAiQ3VyYWJpdHVyIGFjIGVsaXQgaWQgbWFzc2EiICJjb25kaW1lbnR1bSBmaW5pYnVzLiIKCiMgQGRlc2NyaXB0aW9uIGVuc3VyZSBlbnYgZmlsZXMgYXJlIGxvYWRlZAojIEBhcmcgJEAgbGlzdCBvZiBkZWZhdWx0IGZpbGVzIHRvIGxvYWQgYXQgdGhlIGVuZAojIEBleGl0Y29kZSAxIGlmIG9uZSBvZiBlbnYgZmlsZXMgZmFpbHMgdG8gbG9hZAojIEBzdGRlcnIgZGlhZ25vc3RpY3MgaW5mb3JtYXRpb24gaXMgZGlzcGxheWVkCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjEyMApFbnY6OnJlcXVpcmVMb2FkKCkgewogIGxvY2FsIC1hIGRlZmF1bHRGaWxlcz0oIiRAIikKICAjIGdldCBsaXN0IG9mIHBvc3NpYmxlIGNvbmZpZyBmaWxlcwogIGxvY2FsIC1hIGNvbmZpZ0ZpbGVzPSgpCiAgaWYgW1sgLW4gIiR7QkFTSF9GUkFNRVdPUktfRU5WX0ZJTEVTWzBdKzF9IiBdXTsgdGhlbgogICAgIyBCQVNIX0ZSQU1FV09SS19FTlZfRklMRVMgaXMgYW4gYXJyYXkKICAgIGNvbmZpZ0ZpbGVzKz0oIiR7QkFTSF9GUkFNRVdPUktfRU5WX0ZJTEVTW0BdfSIpCiAgZmkKICBpZiBbWyAtZiAiJHtGUkFNRVdPUktfUk9PVF9ESVJ9Ly5mcmFtZXdvcmstY29uZmlnIiBdXTsgdGhlbgogICAgY29uZmlnRmlsZXMrPSgiJHtGUkFNRVdPUktfUk9PVF9ESVJ9Ly5mcmFtZXdvcmstY29uZmlnIikKICBmaQogIGlmIFtbIC1mICIkKHB3ZCkvLmZyYW1ld29yay1jb25maWciIF1dOyB0aGVuCiAgICBjb25maWdGaWxlcys9KCIkKHB3ZCkvLmZyYW1ld29yay1jb25maWciKQogIGZpCiAgaWYgW1sgLW4gIiR7b3B0aW9uQmFzaEZyYW1ld29ya0NvbmZpZ30iICYmIC1mICIke29wdGlvbkJhc2hGcmFtZXdvcmtDb25maWd9IiBdXTsgdGhlbgogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgICBjb25maWdGaWxlcys9KCIke29wdGlvbkJhc2hGcmFtZXdvcmtDb25maWd9IikKICBmaQogIGNvbmZpZ0ZpbGVzKz0oIiR7b3B0aW9uRW52RmlsZXNbQF19IikKICBjb25maWdGaWxlcys9KCIke2RlZmF1bHRGaWxlc1tAXX0iKQoKICBmb3IgZmlsZSBpbiAiJHtjb25maWdGaWxlc1tAXX0iOyBkbwogICAgIyBzaGVsbGNoZWNrIHNvdXJjZT0vLmZyYW1ld29yay1jb25maWcKICAgIHNvdXJjZSAiJHtmaWxlfSIgfHwgewogICAgICBMb2c6OmRpc3BsYXlFcnJvciAid2hpbGUgbG9hZGluZyBjb25maWcgZmlsZTogJHtmaWxlfSIKICAgICAgcmV0dXJuIDEKICAgIH0KICBkb25lCn0KCiMgQGRlc2NyaXB0aW9uIExvZyBuYW1lc3BhY2UgcHJvdmlkZXMgMiBraW5kIG9mIGZ1bmN0aW9ucwojIC0gTG9nOjpkaXNwbGF5KiBhbGxvd3MgdG8gZGlzcGxheSBnaXZlbiBtZXNzYWdlIHdpdGgKIyAgIGdpdmVuIGRpc3BsYXkgbGV2ZWwKIyAtIExvZzo6bG9nKiBhbGxvd3MgdG8gbG9nIGdpdmVuIG1lc3NhZ2Ugd2l0aAojICAgZ2l2ZW4gbG9nIGxldmVsCiMgTG9nOjpkaXNwbGF5KiBmdW5jdGlvbnMgYXV0b21hdGljYWxseSBsb2cgdGhlIG1lc3NhZ2UgdG9vCiMgQHNlZSBFbnY6OnJlcXVpcmVMb2FkIHRvIGxvYWQgdGhlIGRpc3BsYXkgYW5kIGxvZyBsZXZlbCBmcm9tIC5lbnYgZmlsZQoKIyBAZGVzY3JpcHRpb24gbG9nIGxldmVsIG9mZgpleHBvcnQgX19MRVZFTF9PRkY9MAojIEBkZXNjcmlwdGlvbiBsb2cgbGV2ZWwgZXJyb3IKZXhwb3J0IF9fTEVWRUxfRVJST1I9MQojIEBkZXNjcmlwdGlvbiBsb2cgbGV2ZWwgd2FybmluZwpleHBvcnQgX19MRVZFTF9XQVJOSU5HPTIKIyBAZGVzY3JpcHRpb24gbG9nIGxldmVsIGluZm8KZXhwb3J0IF9fTEVWRUxfSU5GTz0zCiMgQGRlc2NyaXB0aW9uIGxvZyBsZXZlbCBzdWNjZXNzCmV4cG9ydCBfX0xFVkVMX1NVQ0NFU1M9MwojIEBkZXNjcmlwdGlvbiBsb2cgbGV2ZWwgZGVidWcKZXhwb3J0IF9fTEVWRUxfREVCVUc9NAoKIyBAZGVzY3JpcHRpb24gdmVyYm9zZSBsZXZlbCBvZmYKZXhwb3J0IF9fVkVSQk9TRV9MRVZFTF9PRkY9MAojIEBkZXNjcmlwdGlvbiB2ZXJib3NlIGxldmVsIGluZm8KZXhwb3J0IF9fVkVSQk9TRV9MRVZFTF9JTkZPPTEKIyBAZGVzY3JpcHRpb24gdmVyYm9zZSBsZXZlbCBpbmZvCmV4cG9ydCBfX1ZFUkJPU0VfTEVWRUxfREVCVUc9MgojIEBkZXNjcmlwdGlvbiB2ZXJib3NlIGxldmVsIGluZm8KZXhwb3J0IF9fVkVSQk9TRV9MRVZFTF9UUkFDRT0zCgojIEBkZXNjcmlwdGlvbiBEaXNwbGF5IG1lc3NhZ2UgdXNpbmcgZGVidWcgY29sb3IgKGdyZXkpCiMgQGFyZyAkMSBtZXNzYWdlOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CkxvZzo6ZGlzcGxheURlYnVnKCkgewogIGlmICgoQkFTSF9GUkFNRVdPUktfRElTUExBWV9MRVZFTCA+PSBfX0xFVkVMX0RFQlVHKSk7IHRoZW4KICAgIGVjaG8gLWUgIiR7X19ERUJVR19DT0xPUn1ERUJVRyAgIC0gJHsxfSR7X19SRVNFVF9DT0xPUn0iID4mMgogIGZpCiAgTG9nOjpsb2dEZWJ1ZyAiJDEiCn0KCiMgQGRlc2NyaXB0aW9uIERpc3BsYXkgbWVzc2FnZSB1c2luZyBlcnJvciBjb2xvciAocmVkKQojIEBhcmcgJDEgbWVzc2FnZTpTdHJpbmcgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheQpMb2c6OmRpc3BsYXlFcnJvcigpIHsKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0RJU1BMQVlfTEVWRUwgPj0gX19MRVZFTF9FUlJPUikpOyB0aGVuCiAgICBlY2hvIC1lICIke19fRVJST1JfQ09MT1J9RVJST1IgICAtICR7MX0ke19fUkVTRVRfQ09MT1J9IiA+JjIKICBmaQogIExvZzo6bG9nRXJyb3IgIiQxIgp9CgojIEBkZXNjcmlwdGlvbiBEaXNwbGF5IG1lc3NhZ2UgdXNpbmcgaW5mbyBjb2xvciAoYmcgbGlnaHQgYmx1ZS9mZyB3aGl0ZSkKIyBAYXJnICQxIG1lc3NhZ2U6U3RyaW5nIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXkKTG9nOjpkaXNwbGF5SW5mbygpIHsKICBsb2NhbCB0eXBlPSIkezI6LUlORk99IgogIGlmICgoQkFTSF9GUkFNRVdPUktfRElTUExBWV9MRVZFTCA+PSBfX0xFVkVMX0lORk8pKTsgdGhlbgogICAgZWNobyAtZSAiJHtfX0lORk9fQ09MT1J9JHt0eXBlfSAgICAtICR7MX0ke19fUkVTRVRfQ09MT1J9IiA+JjIKICBmaQogIExvZzo6bG9nSW5mbyAiJDEiICIke3R5cGV9Igp9CgojIEBkZXNjcmlwdGlvbiBEaXNwbGF5IG1lc3NhZ2UgdXNpbmcgd2FybmluZyBjb2xvciAoeWVsbG93KQojIEBhcmcgJDEgbWVzc2FnZTpTdHJpbmcgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheQpMb2c6OmRpc3BsYXlXYXJuaW5nKCkgewogIGlmICgoQkFTSF9GUkFNRVdPUktfRElTUExBWV9MRVZFTCA+PSBfX0xFVkVMX1dBUk5JTkcpKTsgdGhlbgogICAgZWNobyAtZSAiJHtfX1dBUk5JTkdfQ09MT1J9V0FSTiAgICAtICR7MX0ke19fUkVTRVRfQ09MT1J9IiA+JjIKICBmaQogIExvZzo6bG9nV2FybmluZyAiJDEiCn0KCiMgQGRlc2NyaXB0aW9uIERpc3BsYXkgbWVzc2FnZSB1c2luZyBlcnJvciBjb2xvciAocmVkKSBhbmQgZXhpdCBpbW1lZGlhdGVseSB3aXRoIGVycm9yIHN0YXR1cyAxCiMgQGFyZyAkMSBtZXNzYWdlOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CkxvZzo6ZmF0YWwoKSB7CiAgZWNobyAtZSAiJHtfX0VSUk9SX0NPTE9SfUZBVEFMICAgLSAkezF9JHtfX1JFU0VUX0NPTE9SfSIgPiYyCiAgTG9nOjpsb2dGYXRhbCAiJDEiCiAgZXhpdCAxCn0KCiMgQGRlc2NyaXB0aW9uIGFjdGl2YXRlIG9yIG5vdCBMb2c6OmRpc3BsYXkqIGFuZCBMb2c6OmxvZyogZnVuY3Rpb25zCiMgYmFzZWQgb24gQkFTSF9GUkFNRVdPUktfRElTUExBWV9MRVZFTCBhbmQgQkFTSF9GUkFNRVdPUktfTE9HX0xFVkVMCiMgZW52aXJvbm1lbnQgdmFyaWFibGVzIGxvYWRlZCBieSBFbnY6OnJlcXVpcmVMb2FkCiMgdHJ5IHRvIGNyZWF0ZSBsb2cgZmlsZSBhbmQgcm90YXRlIGl0IGlmIG5lY2Vzc2FyeQojIEBub2FyZ3MKIyBAc2V0IEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCBpbnQgdG8gT0ZGIGxldmVsIGlmIEJBU0hfRlJBTUVXT1JLX0xPR19GSUxFIGlzIGVtcHR5IG9yIG5vdCB3cml0YWJsZQojIEBlbnYgQkFTSF9GUkFNRVdPUktfRElTUExBWV9MRVZFTCBpbnQKIyBAZW52IEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCBpbnQKIyBAZW52IEJBU0hfRlJBTUVXT1JLX0xPR19GSUxFIFN0cmluZwojIEBlbnYgQkFTSF9GUkFNRVdPUktfTE9HX0ZJTEVfTUFYX1JPVEFUSU9OIGludCBkbyBsb2cgcm90YXRpb24gaWYgPiAwCiMgQGV4aXRjb2RlIDAgYWx3YXlzIHN1Y2Nlc3NmdWwKIyBAc3RkZXJyIGRpYWdub3N0aWNzIGluZm9ybWF0aW9uIGFib3V0IGxvZyBmaWxlIGlzIGRpc3BsYXllZAojIEByZXF1aXJlIEVudjo6cmVxdWlyZUxvYWQKIyBAcmVxdWlyZSBVSTo6cmVxdWlyZVRoZW1lCkxvZzo6cmVxdWlyZUxvYWQoKSB7CiAgaWYgW1sgLXogIiR7QkFTSF9GUkFNRVdPUktfTE9HX0ZJTEU6LX0iIF1dOyB0aGVuCiAgICBCQVNIX0ZSQU1FV09SS19MT0dfTEVWRUw9JHtfX0xFVkVMX09GRn0KICAgIGV4cG9ydCBCQVNIX0ZSQU1FV09SS19MT0dfTEVWRUwKICBmaQoKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCA+IF9fTEVWRUxfT0ZGKSk7IHRoZW4KICAgIGlmIFtbICEgLWYgIiR7QkFTSF9GUkFNRVdPUktfTE9HX0ZJTEV9IiBdXTsgdGhlbgogICAgICBpZgogICAgICAgICEgbWtkaXIgLXAgIiQoZGlybmFtZSAiJHtCQVNIX0ZSQU1FV09SS19MT0dfRklMRX0iKSIgMj4vZGV2L251bGwgfHwKICAgICAgICAgICEgdG91Y2ggLS1uby1jcmVhdGUgIiR7QkFTSF9GUkFNRVdPUktfTE9HX0ZJTEV9IiAyPi9kZXYvbnVsbAogICAgICB0aGVuCiAgICAgICAgQkFTSF9GUkFNRVdPUktfTE9HX0xFVkVMPSR7X19MRVZFTF9PRkZ9CiAgICAgICAgZWNobyAtZSAiJHtfX0VSUk9SX0NPTE9SfUVSUk9SICAgLSBGaWxlICR7QkFTSF9GUkFNRVdPUktfTE9HX0ZJTEV9IGlzIG5vdCB3cml0YWJsZSR7X19SRVNFVF9DT0xPUn0iID4mMgogICAgICBmaQogICAgZWxpZiBbWyAhIC13ICIke0JBU0hfRlJBTUVXT1JLX0xPR19GSUxFfSIgXV07IHRoZW4KICAgICAgQkFTSF9GUkFNRVdPUktfTE9HX0xFVkVMPSR7X19MRVZFTF9PRkZ9CiAgICAgIGVjaG8gLWUgIiR7X19FUlJPUl9DT0xPUn1FUlJPUiAgIC0gRmlsZSAke0JBU0hfRlJBTUVXT1JLX0xPR19GSUxFfSBpcyBub3Qgd3JpdGFibGUke19fUkVTRVRfQ09MT1J9IiA+JjIKICAgIGZpCgogIGZpCgogIGlmICgoQkFTSF9GUkFNRVdPUktfTE9HX0xFVkVMID4gX19MRVZFTF9PRkYpKTsgdGhlbgogICAgIyB3aWxsIGFsd2F5cyBiZSBjcmVhdGVkIGV2ZW4gaWYgbm90IGluIGluZm8gbGV2ZWwKICAgIExvZzo6bG9nTWVzc2FnZSAiSU5GTyIgIkxvZ2dpbmcgdG8gZmlsZSAke0JBU0hfRlJBTUVXT1JLX0xPR19GSUxFfSAtIExvZyBsZXZlbCAke0JBU0hfRlJBTUVXT1JLX0xPR19MRVZFTH0iCiAgICBpZiAoKEJBU0hfRlJBTUVXT1JLX0xPR19GSUxFX01BWF9ST1RBVElPTiA+IDApKTsgdGhlbgogICAgICBMb2c6OnJvdGF0ZSAiJHtCQVNIX0ZSQU1FV09SS19MT0dfRklMRX0iICIke0JBU0hfRlJBTUVXT1JLX0xPR19GSUxFX01BWF9ST1RBVElPTn0iCiAgICBmaQogIGZpCn0KCiMgQGRlc2NyaXB0aW9uIGRyYXcgYSBsaW5lIHdpdGggdGhlIGNoYXJhY3RlciBwYXNzZWQgaW4gcGFyYW1ldGVyIHJlcGVhdGVkIGRlcGVuZGluZyBvbiB0ZXJtaW5hbCB3aWR0aAojIEBhcmcgJDEgY2hhcmFjdGVyOlN0cmluZyBjaGFyYWN0ZXIgdG8gdXNlIGFzIHNlcGFyYXRvciAoZGVmYXVsdCB2YWx1ZSAjKQpVSTo6ZHJhd0xpbmUoKSB7CiAgbG9jYWwgY2hhcmFjdGVyPSIkezE6LSN9IgogIHByaW50ZiAnJSpzXG4nICIke0NPTFVNTlM6LSQoW1sgLXQgMCBdXSAmJiB0cHV0IGNvbHMgfHwgZWNobyl9IiAnJyB8IHRyICcgJyAiJHtjaGFyYWN0ZXJ9Igp9CgojIEBkZXNjcmlwdGlvbiBsb2FkIGNvbG9ycyB0aGVtZSBjb25zdGFudHMKIyBAd2FybmluZyBpZiB0dHkgbm90IG9wZW5lZCwgbm9Db2xvciB0aGVtZSB3aWxsIGJlIGNob3NlbgojIEBhcmcgJDEgdGhlbWU6U3RyaW5nIHRoZSB0aGVtZSB0byB1c2UgKGRlZmF1bHQsIG5vQ29sb3IpCiMgQGFyZyAkQCBhcmdzOlN0cmluZ1tdCiMgQHNldCBfX0VSUk9SX0NPTE9SIFN0cmluZyBpbmRpY2F0ZSBlcnJvciBzdGF0dXMKIyBAc2V0IF9fSU5GT19DT0xPUiBTdHJpbmcgaW5kaWNhdGUgaW5mbyBzdGF0dXMKIyBAc2V0IF9fU1VDQ0VTU19DT0xPUiBTdHJpbmcgaW5kaWNhdGUgc3VjY2VzcyBzdGF0dXMKIyBAc2V0IF9fV0FSTklOR19DT0xPUiBTdHJpbmcgaW5kaWNhdGUgd2FybmluZyBzdGF0dXMKIyBAc2V0IF9fU0tJUFBFRF9DT0xPUiBTdHJpbmcgaW5kaWNhdGUgc2tpcHBlZCBzdGF0dXMKIyBAc2V0IF9fREVCVUdfQ09MT1IgU3RyaW5nIGluZGljYXRlIGRlYnVnIHN0YXR1cwojIEBzZXQgX19IRUxQX0NPTE9SIFN0cmluZyBpbmRpY2F0ZSBoZWxwIHN0YXR1cwojIEBzZXQgX19URVNUX0NPTE9SIFN0cmluZyBub3QgdXNlZAojIEBzZXQgX19URVNUX0VSUk9SX0NPTE9SIFN0cmluZyBub3QgdXNlZAojIEBzZXQgX19IRUxQX1RJVExFX0NPTE9SIFN0cmluZyB1c2VkIHRvIGRpc3BsYXkgaGVscCB0aXRsZSBpbiBoZWxwIHN0cmluZ3MKIyBAc2V0IF9fSEVMUF9PUFRJT05fQ09MT1IgU3RyaW5nIHVzZWQgdG8gZGlzcGxheSBoaWdobGlnaHQgb3B0aW9ucyBpbiBoZWxwIHN0cmluZ3MKIwojIEBzZXQgX19SRVNFVF9DT0xPUiBTdHJpbmcgcmVzZXQgZGVmYXVsdCBjb2xvcgojCiMgQHNldCBfX0hFTFBfRVhBTVBMRSBTdHJpbmcgdG8gcmVtb3ZlCiMgQHNldCBfX0hFTFBfVElUTEUgU3RyaW5nIHRvIHJlbW92ZQojIEBzZXQgX19IRUxQX05PUk1BTCBTdHJpbmcgdG8gcmVtb3ZlCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNApVSTo6dGhlbWUoKSB7CiAgbG9jYWwgdGhlbWU9IiR7MS1kZWZhdWx0fSIKICBpZiBbWyAhICIke3RoZW1lfSIgPX4gLWZvcmNlJCBdXSAmJiAhIEFzc2VydDo6dHR5OyB0aGVuCiAgICB0aGVtZT0ibm9Db2xvciIKICBmaQogIGNhc2UgIiR7dGhlbWV9IiBpbgogICAgZGVmYXVsdCB8IGRlZmF1bHQtZm9yY2UpCiAgICAgIHRoZW1lPSJkZWZhdWx0IgogICAgICA7OwogICAgbm9Db2xvcikgOzsKICAgICopCiAgICAgIExvZzo6ZmF0YWwgImludmFsaWQgdGhlbWUgcHJvdmlkZWQiCiAgICAgIDs7CiAgZXNhYwogIGlmIFtbICIke3RoZW1lfSIgPSAiZGVmYXVsdCIgXV07IHRoZW4KICAgIEJBU0hfRlJBTUVXT1JLX1RIRU1FPSJkZWZhdWx0IgogICAgIyBjaGVjayBjb2xvcnMgYXBwbGljYWJsZSBodHRwczovL21pc2MuZmxvZ2lzb2Z0LmNvbS9iYXNoL3RpcF9jb2xvcnNfYW5kX2Zvcm1hdHRpbmcKICAgIF9fRVJST1JfQ09MT1I9J1xlWzMxbScgICAgICAgICAjIFJlZAogICAgX19JTkZPX0NPTE9SPSdcZVs0NG0nICAgICAgICAgICMgd2hpdGUgb24gbGlnaHRCbHVlCiAgICBfX1NVQ0NFU1NfQ09MT1I9J1xlWzMybScgICAgICAgIyBHcmVlbgogICAgX19XQVJOSU5HX0NPTE9SPSdcZVszM20nICAgICAgICMgWWVsbG93CiAgICBfX1NLSVBQRURfQ09MT1I9J1xlWzMzbScgICAgICAgIyBZZWxsb3cKICAgIF9fREVCVUdfQ09MT1I9J1xlWzM3bScgICAgICAgICAjIEdyZXkKICAgIF9fSEVMUF9DT0xPUj0nXGVbNzs0OTszM20nICAgICAjIEJsYWNrIG9uIEdvbGQKICAgIF9fVEVTVF9DT0xPUj0nXGVbMTAwbScgICAgICAgICAjIExpZ2h0IG1hZ2VudGEKICAgIF9fVEVTVF9FUlJPUl9DT0xPUj0nXGVbNDFtJyAgICAjIHdoaXRlIG9uIHJlZAogICAgX19IRUxQX1RJVExFX0NPTE9SPSJcZVsxOzM3bSIgICMgQm9sZAogICAgX19IRUxQX09QVElPTl9DT0xPUj0iXGVbMTszNG0iICMgQmx1ZQogICAgIyBJbnRlcm5hbDogcmVzZXQgY29sb3IKICAgIF9fUkVTRVRfQ09MT1I9J1xlWzBtJyAjIFJlc2V0IENvbG9yCiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIxNTUsU0MyMDM0CiAgICBfX0hFTFBfRVhBTVBMRT0iJChlY2hvIC1lICJcZVsyOzk3bSIpIgogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMTU1LFNDMjAzNAogICAgX19IRUxQX1RJVExFPSIkKGVjaG8gLWUgIlxlWzE7MzdtIikiCiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIxNTUsU0MyMDM0CiAgICBfX0hFTFBfTk9STUFMPSIkKGVjaG8gLWUgIlwwMzNbMG0iKSIKICBlbHNlCiAgICBCQVNIX0ZSQU1FV09SS19USEVNRT0ibm9Db2xvciIKICAgICMgY2hlY2sgY29sb3JzIGFwcGxpY2FibGUgaHR0cHM6Ly9taXNjLmZsb2dpc29mdC5jb20vYmFzaC90aXBfY29sb3JzX2FuZF9mb3JtYXR0aW5nCiAgICBfX0VSUk9SX0NPTE9SPScnCiAgICBfX0lORk9fQ09MT1I9JycKICAgIF9fU1VDQ0VTU19DT0xPUj0nJwogICAgX19XQVJOSU5HX0NPTE9SPScnCiAgICBfX1NLSVBQRURfQ09MT1I9JycKICAgIF9fREVCVUdfQ09MT1I9JycKICAgIF9fSEVMUF9DT0xPUj0nJwogICAgX19URVNUX0NPTE9SPScnCiAgICBfX1RFU1RfRVJST1JfQ09MT1I9JycKICAgIF9fSEVMUF9USVRMRV9DT0xPUj0nJwogICAgX19IRUxQX09QVElPTl9DT0xPUj0nJwogICAgIyBJbnRlcm5hbDogcmVzZXQgY29sb3IKICAgIF9fUkVTRVRfQ09MT1I9JycKICAgIF9fSEVMUF9FWEFNUExFPScnCiAgICBfX0hFTFBfVElUTEU9JycKICAgIF9fSEVMUF9OT1JNQUw9JycKICBmaQp9CgojIEBkZXNjcmlwdGlvbiBlbnN1cmUgQ09NTUFORF9CSU5fRElSIGVudiB2YXIgaXMgc2V0CiMgYW5kIFBBVEggY29ycmVjdGx5IHByZXBhcmVkCiMgQG5vYXJncwojIEBzZXQgQ09NTUFORF9CSU5fRElSIHN0cmluZyB0aGUgZGlyZWN0b3J5IHdoZXJlIHRvIGZpbmQgdGhpcyBjb21tYW5kCiMgQHNldCBQQVRIIHN0cmluZyBhZGQgZGlyZWN0b3J5IHdoZXJlIHRvIGZpbmQgdGhpcyBjb21tYW5kIGJpbmFyeQpDb21waWxlcjo6RmFjYWRlOjpyZXF1aXJlQ29tbWFuZEJpbkRpcigpIHsKICBDT01NQU5EX0JJTl9ESVI9IiR7Q1VSUkVOVF9ESVJ9IgogIEVudjo6cGF0aFByZXBlbmQgIiR7Q09NTUFORF9CSU5fRElSfSIKfQoKIyBAZGVzY3JpcHRpb24gY2hlY2sgaWYgdHR5IChpbnRlcmFjdGl2ZSBtb2RlKSBpcyBhY3RpdmUKIyBAbm9hcmdzCiMgQGV4aXRjb2RlIDEgaWYgdHR5IG5vdCBhY3RpdmUKIyBAZW52IE5PTl9JTlRFUkFDVElWRSBpZiAxIGNvbnNpZGVyIGFzIG5vdCBpbnRlcmFjdGl2ZSBldmVuIGlmIGVudmlyb25tZW50IGlzIGludGVyYWN0aXZlCiMgQGVudiBJTlRFUkFDVElWRSBpZiAxIGNvbnNpZGVyIGFzIGludGVyYWN0aXZlIGV2ZW4gaWYgZW52aXJvbm1lbnQgaXMgbm90IGludGVyYWN0aXZlCiMgQHN0ZGVyciBkaWFnbm9zdGljIGluZm9ybWF0aW9uICsgaGVscCBpZiBzZWNvbmQgYXJndW1lbnQgaXMgcHJvdmlkZWQKQXNzZXJ0Ojp0dHkoKSB7CiAgaWYgW1sgIiR7Tk9OX0lOVEVSQUNUSVZFOi0wfSIgPSAiMSIgXV07IHRoZW4KICAgIHJldHVybiAxCiAgZmkKICBpZiBbWyAiJHtJTlRFUkFDVElWRTotMH0iID0gIjEiIF1dOyB0aGVuCiAgICByZXR1cm4gMAogIGZpCiAgW1sgLXQgMSB8fCAtdCAyIF1dCn0KCiMgQGRlc2NyaXB0aW9uIHByZXBlbmQgZGlyZWN0b3JpZXMgdG8gdGhlIFBBVEggZW52aXJvbm1lbnQgdmFyaWFibGUKIyBAYXJnICRAIGFyZ3M6U3RyaW5nW10gbGlzdCBvZiBkaXJlY3RvcmllcyB0byBwcmVwZW5kCiMgQHNldCBQQVRIIHVwZGF0ZSBQQVRIIHdpdGggdGhlIGRpcmVjdG9yaWVzIHByZXBlbmRlZApFbnY6OnBhdGhQcmVwZW5kKCkgewogIGxvY2FsIGFyZwogIGZvciBhcmcgaW4gIiRAIjsgZG8KICAgIGlmIFtbIC1kICIke2FyZ30iICYmICI6JHtQQVRIfToiICE9ICoiOiR7YXJnfToiKiBdXTsgdGhlbgogICAgICBQQVRIPSIkKHJlYWxwYXRoICIke2FyZ30iKToke1BBVEh9IgogICAgZmkKICBkb25lCn0KCiMgQGRlc2NyaXB0aW9uIHJlbW92ZSBhbnNpIGNvZGVzIGZyb20gaW5wdXQgb3IgZmlsZXMgZ2l2ZW4gYXMgYXJndW1lbnQKIyBAYXJnICRAIGZpbGVzOlN0cmluZ1tdIHRoZSBmaWxlcyB0byBmaWx0ZXIKIyBAZXhpdGNvZGUgKiBpZiBvbmUgb2YgdGhlIGZpbHRlciBjb21tYW5kIGZhaWxzCiMgQHN0ZGluIHlvdSBjYW4gdXNlIHN0ZGluIGFzIGFsdGVybmF0aXZlIHRvIGZpbGVzIGFyZ3VtZW50CiMgQHN0ZG91dCB0aGUgZmlsdGVyZWQgY29udGVudAojIEBzZWUgaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvQU5TSV9lc2NhcGVfY29kZQojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIxMjAKRmlsdGVyczo6cmVtb3ZlQW5zaUNvZGVzKCkgewogICMgY3NwZWxsOmRpc2FibGUKICBzZWQgLUUgJ3MvXHgxYlxbWzAtOTtdKlttR0tIRl0vL2cnICIkQCIKICAjIGNzcGVsbDplbmFibGUKfQoKIyBAZGVzY3JpcHRpb24gbG9nIG1lc3NhZ2UgdG8gZmlsZQojIEBhcmcgJDEgbWVzc2FnZTpTdHJpbmcgdGhlIG1lc3NhZ2UgdG8gZGlzcGxheQpMb2c6OmxvZ0RlYnVnKCkgewogIGlmICgoQkFTSF9GUkFNRVdPUktfTE9HX0xFVkVMID49IF9fTEVWRUxfREVCVUcpKTsgdGhlbgogICAgTG9nOjpsb2dNZXNzYWdlICIkezI6LURFQlVHfSIgIiQxIgogIGZpCn0KCiMgQGRlc2NyaXB0aW9uIGxvZyBtZXNzYWdlIHRvIGZpbGUKIyBAYXJnICQxIG1lc3NhZ2U6U3RyaW5nIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXkKTG9nOjpsb2dFcnJvcigpIHsKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCA+PSBfX0xFVkVMX0VSUk9SKSk7IHRoZW4KICAgIExvZzo6bG9nTWVzc2FnZSAiJHsyOi1FUlJPUn0iICIkMSIKICBmaQp9CgojIEBkZXNjcmlwdGlvbiBsb2cgbWVzc2FnZSB0byBmaWxlCiMgQGFyZyAkMSBtZXNzYWdlOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CkxvZzo6bG9nRmF0YWwoKSB7CiAgTG9nOjpsb2dNZXNzYWdlICIkezI6LUZBVEFMfSIgIiQxIgp9CgojIEBkZXNjcmlwdGlvbiBsb2cgbWVzc2FnZSB0byBmaWxlCiMgQGFyZyAkMSBtZXNzYWdlOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CkxvZzo6bG9nSW5mbygpIHsKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCA+PSBfX0xFVkVMX0lORk8pKTsgdGhlbgogICAgTG9nOjpsb2dNZXNzYWdlICIkezI6LUlORk99IiAiJDEiCiAgZmkKfQoKIyBAZGVzY3JpcHRpb24gSW50ZXJuYWw6IGNvbW1vbiBsb2cgbWVzc2FnZQojIEBleGFtcGxlIHRleHQKIyAgIFtkYXRlXXxbbGV2ZWxNc2ddfG1lc3NhZ2UKIwojIEBleGFtcGxlIHRleHQKIyAgIDIwMjAtMDEtMTkgMTk6MjA6MjF8RVJST1IgIHxsb2cgZXJyb3IKIyAgIDIwMjAtMDEtMTkgMTk6MjA6MjF8U0tJUFBFRHxsb2cgc2tpcHBlZAojCiMgQGFyZyAkMSBsZXZlbE1zZzpTdHJpbmcgbWVzc2FnZSdzIGxldmVsIGRlc2NyaXB0aW9uIChlZzogU1RBVFVTLCBFUlJPUiwgLi4uKQojIEBhcmcgJDIgbXNnOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CiMgQGVudiBCQVNIX0ZSQU1FV09SS19MT0dfRklMRSBTdHJpbmcgbG9nIGZpbGUgdG8gdXNlLCBkbyBub3RoaW5nIGlmIGVtcHR5CiMgQGVudiBCQVNIX0ZSQU1FV09SS19MT0dfTEVWRUwgaW50IGxvZyBsZXZlbCBsb2cgb25seSBpZiA+IE9GRiBvciBmYXRhbCBtZXNzYWdlcwojIEBzdGRlcnIgZGlhZ25vc3RpY3MgaW5mb3JtYXRpb24gaXMgZGlzcGxheWVkCiMgQHJlcXVpcmUgRW52OjpyZXF1aXJlTG9hZAojIEByZXF1aXJlIExvZzo6cmVxdWlyZUxvYWQKTG9nOjpsb2dNZXNzYWdlKCkgewogIGxvY2FsIGxldmVsTXNnPSIkMSIKICBsb2NhbCBtc2c9IiQyIgogIGxvY2FsIGRhdGUKCiAgaWYgW1sgLW4gIiR7QkFTSF9GUkFNRVdPUktfTE9HX0ZJTEV9IiBdXSAmJiAoKEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCA+IF9fTEVWRUxfT0ZGKSk7IHRoZW4KICAgIGRhdGU9IiQoZGF0ZSAnKyVZLSVtLSVkICVIOiVNOiVTJykiCiAgICB0b3VjaCAiJHtCQVNIX0ZSQU1FV09SS19MT0dfRklMRX0iCiAgICBwcmludGYgIiVzfCU3c3wlc1xuIiAiJHtkYXRlfSIgIiR7bGV2ZWxNc2d9IiAiJHttc2d9IiA+PiIke0JBU0hfRlJBTUVXT1JLX0xPR19GSUxFfSIKICBmaQp9CgojIEBkZXNjcmlwdGlvbiBsb2cgbWVzc2FnZSB0byBmaWxlCiMgQGFyZyAkMSBtZXNzYWdlOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CkxvZzo6bG9nV2FybmluZygpIHsKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCA+PSBfX0xFVkVMX1dBUk5JTkcpKTsgdGhlbgogICAgTG9nOjpsb2dNZXNzYWdlICIkezI6LVdBUk5JTkd9IiAiJDEiCiAgZmkKfQoKIyBAZGVzY3JpcHRpb24gVG8gYmUgY2FsbGVkIGJlZm9yZSBsb2dnaW5nIGluIHRoZSBsb2cgZmlsZQojIEBhcmcgJDEgZmlsZTpzdHJpbmcgbG9nIGZpbGUgbmFtZQojIEBhcmcgJDIgbWF4TG9nRmlsZXNDb3VudDppbnQgbWF4aW11bSBudW1iZXIgb2YgbG9nIGZpbGVzCkxvZzo6cm90YXRlKCkgewogIGxvY2FsIGZpbGU9IiQxIgogIGxvY2FsIG1heExvZ0ZpbGVzQ291bnQ9IiR7MjotNX0iCgogIGlmIFtbICEgLWYgIiR7ZmlsZX0iIF1dOyB0aGVuCiAgICBMb2c6OmRpc3BsYXlTa2lwcGVkICJMb2cgZmlsZSAke2ZpbGV9IGRvZXNuJ3QgZXhpc3QgeWV0IgogICAgcmV0dXJuIDAKICBmaQogIGZvciBpIGluICQoc2VxICQoKG1heExvZ0ZpbGVzQ291bnQgLSAxKSkgLTEgMSk7IGRvCiAgICBMb2c6OmRpc3BsYXlJbmZvICJMb2cgcm90YXRpb24gJHtmaWxlfS4ke2l9IHRvICR7ZmlsZX0uJCgoaSArIDEpKSIKICAgIG12ICIke2ZpbGV9LiJ7IiR7aX0iLCIkKChpICsgMSkpIn0gJj4vZGV2L251bGwgfHwgdHJ1ZQogIGRvbmUKICBpZiBjcCAiJHtmaWxlfSIgIiR7ZmlsZX0uMSIgJj4vZGV2L251bGw7IHRoZW4KICAgIGVjaG8gPiIke2ZpbGV9IiAjIHJlc2V0IGxvZyBmaWxlCiAgICBMb2c6OmRpc3BsYXlJbmZvICJMb2cgcm90YXRpb24gJHtmaWxlfSB0byAke2ZpbGV9LjEiCiAgZmkKfQoKIyBAZGVzY3JpcHRpb24gbG9hZCBjb2xvciB0aGVtZQojIEBub2FyZ3MKIyBAZW52IEJBU0hfRlJBTUVXT1JLX1RIRU1FIFN0cmluZyB0aGVtZSB0byB1c2UKIyBAZXhpdGNvZGUgMCBhbHdheXMgc3VjY2Vzc2Z1bApVSTo6cmVxdWlyZVRoZW1lKCkgewogIFVJOjp0aGVtZSAiJHtCQVNIX0ZSQU1FV09SS19USEVNRS1kZWZhdWx0fSIKfQoKIyBAZGVzY3JpcHRpb24gRGlzcGxheSBtZXNzYWdlIHVzaW5nIHNraXAgY29sb3IgKHllbGxvdykKIyBAYXJnICQxIG1lc3NhZ2U6U3RyaW5nIHRoZSBtZXNzYWdlIHRvIGRpc3BsYXkKTG9nOjpkaXNwbGF5U2tpcHBlZCgpIHsKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0RJU1BMQVlfTEVWRUwgPj0gX19MRVZFTF9JTkZPKSk7IHRoZW4KICAgIGVjaG8gLWUgIiR7X19TS0lQUEVEX0NPTE9SfVNLSVBQRUQgLSAkezF9JHtfX1JFU0VUX0NPTE9SfSIgPiYyCiAgZmkKICBMb2c6OmxvZ1NraXBwZWQgIiQxIgp9CgojIEBkZXNjcmlwdGlvbiBsb2cgbWVzc2FnZSB0byBmaWxlCiMgQGFyZyAkMSBtZXNzYWdlOlN0cmluZyB0aGUgbWVzc2FnZSB0byBkaXNwbGF5CkxvZzo6bG9nU2tpcHBlZCgpIHsKICBpZiAoKEJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTCA+PSBfX0xFVkVMX0lORk8pKTsgdGhlbgogICAgTG9nOjpsb2dNZXNzYWdlICIkezI6LVNLSVBQRUR9IiAiJDEiCiAgZmkKfQoKIyBGVU5DVElPTlMKCmZhY2FkZV9tYWluX2J1aWxkUHVzaERvY2tlckltYWdlc2goKSB7CkZSQU1FV09SS19ST09UX0RJUj0iJChjZCAiJHtDVVJSRU5UX0RJUn0vLi4iICYmIHB3ZCAtUCkiCkZSQU1FV09SS19TUkNfRElSPSIke0ZSQU1FV09SS19ST09UX0RJUn0vc3JjIgpGUkFNRVdPUktfQklOX0RJUj0iJHtGUkFNRVdPUktfUk9PVF9ESVJ9L2JpbiIKRlJBTUVXT1JLX1ZFTkRPUl9ESVI9IiR7RlJBTUVXT1JLX1JPT1RfRElSfS92ZW5kb3IiCkZSQU1FV09SS19WRU5ET1JfQklOX0RJUj0iJHtGUkFNRVdPUktfUk9PVF9ESVJ9L3ZlbmRvci9iaW4iCiMgUkVRVUlSRVMKRW52OjpyZXF1aXJlTG9hZApVSTo6cmVxdWlyZVRoZW1lCkxvZzo6cmVxdWlyZUxvYWQKQ29tcGlsZXI6OkZhY2FkZTo6cmVxdWlyZUNvbW1hbmRCaW5EaXIKCiMgQHJlcXVpcmUgQ29tcGlsZXI6OkZhY2FkZTo6cmVxdWlyZUNvbW1hbmRCaW5EaXIKCmRlY2xhcmUgLWEgQkFTSF9GUkFNRVdPUktfQVJHVl9GSUxURVJFRD0oKQoKY29weXJpZ2h0Q2FsbGJhY2soKSB7CiAgaWYgW1sgLXogIiR7Y29weXJpZ2h0QmVnaW5ZZWFyfSIgXV07IHRoZW4KICAgIGNvcHlyaWdodEJlZ2luWWVhcj0iJChkYXRlICslWSkiCiAgZmkKICBlY2hvICJDb3B5cmlnaHQgKGMpICR7Y29weXJpZ2h0QmVnaW5ZZWFyfS1ub3cgRnJhbsOnb2lzIENoYXN0YW5ldCIKfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVBcmdMaXN0SW5mb1ZlcmJvc2VDYWxsYmFjaygpIHsKICBCQVNIX0ZSQU1FV09SS19BUkdWX0ZJTFRFUkVEKz0oLS12ZXJib3NlKQp9CiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4KdXBkYXRlQXJnTGlzdERlYnVnVmVyYm9zZUNhbGxiYWNrKCkgewogIEJBU0hfRlJBTUVXT1JLX0FSR1ZfRklMVEVSRUQrPSgtdnYpCn0KIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVBcmdMaXN0VHJhY2VWZXJib3NlQ2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfQVJHVl9GSUxURVJFRCs9KC12dnYpCn0KIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVBcmdMaXN0RW52RmlsZUNhbGxiYWNrKCkgeyA6OyB9CiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4KdXBkYXRlQXJnTGlzdExvZ0xldmVsQ2FsbGJhY2soKSB7IDo7IH0KIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVBcmdMaXN0RGlzcGxheUxldmVsQ2FsbGJhY2soKSB7IDo7IH0KIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVBcmdMaXN0Tm9Db2xvckNhbGxiYWNrKCkgewogIEJBU0hfRlJBTUVXT1JLX0FSR1ZfRklMVEVSRUQrPSgtLW5vLWNvbG9yKQp9CiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4KdXBkYXRlQXJnTGlzdFRoZW1lQ2FsbGJhY2soKSB7IDo7IH0KIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVBcmdMaXN0UXVpZXRDYWxsYmFjaygpIHsgOjsgfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgpvcHRpb25IZWxwQ2FsbGJhY2soKSB7CiAgYnVpbGRQdXNoRG9ja2VySW1hZ2VDb21tYW5kIGhlbHAKICBleGl0IDAKfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgpvcHRpb25WZXJzaW9uQ2FsbGJhY2soKSB7CiAgZWNobyAiJHtTQ1JJUFRfTkFNRX0gdmVyc2lvbiAxLjAiCiAgZXhpdCAwCn0KCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4Kb3B0aW9uRW52RmlsZUNhbGxiYWNrKCkgewogIGxvY2FsIGVudkZpbGU9IiQyIgogIExvZzo6ZGlzcGxheVdhcm5pbmcgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gLS1lbnYtZmlsZSBpcyBkZXByZWNhdGVkIGFuZCB3aWxsIGJlIHJlbW92ZWQgaW4gdGhlIGZ1dHVyZSIKICBpZiBbWyAhIC1mICIke2VudkZpbGV9IiB8fCAhIC1yICIke2VudkZpbGV9IiBdXTsgdGhlbgogICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gLS1lbnYtZmlsZSAtIEZpbGUgJyR7ZW52RmlsZX0nIGRvZXNuJ3QgZXhpc3QiCiAgICBleGl0IDEKICBmaQp9CgojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIzMTcgIyBpZiBmdW5jdGlvbiBpcyBvdmVycmlkZGVuCm9wdGlvbkluZm9WZXJib3NlQ2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfQVJHU19WRVJCT1NFX09QVElPTj0nLS12ZXJib3NlJwogIEJBU0hfRlJBTUVXT1JLX0FSR1NfVkVSQk9TRT0ke19fVkVSQk9TRV9MRVZFTF9JTkZPfQogIEJBU0hfRlJBTUVXT1JLX0RJU1BMQVlfTEVWRUw9JHtfX0xFVkVMX0lORk99Cn0KCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4Kb3B0aW9uRGVidWdWZXJib3NlQ2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfQVJHU19WRVJCT1NFX09QVElPTj0nLXZ2JwogIEJBU0hfRlJBTUVXT1JLX0FSR1NfVkVSQk9TRT0ke19fVkVSQk9TRV9MRVZFTF9ERUJVR30KICBCQVNIX0ZSQU1FV09SS19ESVNQTEFZX0xFVkVMPSR7X19MRVZFTF9ERUJVR30KfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgpvcHRpb25UcmFjZVZlcmJvc2VDYWxsYmFjaygpIHsKICBCQVNIX0ZSQU1FV09SS19BUkdTX1ZFUkJPU0VfT1BUSU9OPSctdnZ2JwogIEJBU0hfRlJBTUVXT1JLX0FSR1NfVkVSQk9TRT0ke19fVkVSQk9TRV9MRVZFTF9UUkFDRX0KICBCQVNIX0ZSQU1FV09SS19ESVNQTEFZX0xFVkVMPSR7X19MRVZFTF9ERUJVR30KfQoKZ2V0TGV2ZWwoKSB7CiAgbG9jYWwgbGV2ZWxOYW1lPSIkMSIKICBjYXNlICIke2xldmVsTmFtZV5efSIgaW4KICAgIE9GRikKICAgICAgZWNobyAiJHtfX0xFVkVMX09GRn0iCiAgICAgIDs7CiAgICBFUlJPUikKICAgICAgZWNobyAiJHtfX0xFVkVMX0VSUk9SfSIKICAgICAgOzsKICAgIFdBUk5JTkcpCiAgICAgIGVjaG8gIiR7X19MRVZFTF9XQVJOSU5HfSIKICAgICAgOzsKICAgIElORk8pCiAgICAgIGVjaG8gIiR7X19MRVZFTF9JTkZPfSIKICAgICAgOzsKICAgIERFQlVHIHwgVFJBQ0UpCiAgICAgIGVjaG8gIiR7X19MRVZFTF9ERUJVR30iCiAgICAgIDs7CiAgICAqKQogICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIEludmFsaWQgbGV2ZWwgJHtsZXZlbH0iCiAgICAgIHJldHVybiAxCiAgZXNhYwp9CgpnZXRWZXJib3NlTGV2ZWwoKSB7CiAgbG9jYWwgbGV2ZWxOYW1lPSIkMSIKICBjYXNlICIke2xldmVsTmFtZV5efSIgaW4KICAgIE9GRikKICAgICAgZWNobyAiJHtfX1ZFUkJPU0VfTEVWRUxfT0ZGfSIKICAgICAgOzsKICAgIEVSUk9SIHwgV0FSTklORyB8IElORk8pCiAgICAgIGVjaG8gIiR7X19WRVJCT1NFX0xFVkVMX0lORk99IgogICAgICA7OwogICAgREVCVUcpCiAgICAgIGVjaG8gIiR7X19WRVJCT1NFX0xFVkVMX0RFQlVHfSIKICAgICAgOzsKICAgIFRSQUNFKQogICAgICBlY2hvICIke19fVkVSQk9TRV9MRVZFTF9UUkFDRX0iCiAgICAgIDs7CiAgICAqKQogICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIEludmFsaWQgbGV2ZWwgJHtsZXZlbH0iCiAgICAgIHJldHVybiAxCiAgZXNhYwp9CgojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIzMTcgIyBpZiBmdW5jdGlvbiBpcyBvdmVycmlkZGVuCm9wdGlvbkRpc3BsYXlMZXZlbENhbGxiYWNrKCkgewogIGxvY2FsIGxldmVsPSIkMiIKICBsb2NhbCBsb2dMZXZlbCB2ZXJib3NlTGV2ZWwKICBsb2dMZXZlbD0iJChnZXRMZXZlbCAiJHtsZXZlbH0iKSIKICB2ZXJib3NlTGV2ZWw9IiQoZ2V0VmVyYm9zZUxldmVsICIke2xldmVsfSIpIgogIEJBU0hfRlJBTUVXT1JLX0FSR1NfVkVSQk9TRT0ke3ZlcmJvc2VMZXZlbH0KICBCQVNIX0ZSQU1FV09SS19ESVNQTEFZX0xFVkVMPSR7bG9nTGV2ZWx9Cn0KCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4Kb3B0aW9uTG9nTGV2ZWxDYWxsYmFjaygpIHsKICBsb2NhbCBsZXZlbD0iJDIiCiAgbG9jYWwgbG9nTGV2ZWwgdmVyYm9zZUxldmVsCiAgbG9nTGV2ZWw9IiQoZ2V0TGV2ZWwgIiR7bGV2ZWx9IikiCiAgdmVyYm9zZUxldmVsPSIkKGdldFZlcmJvc2VMZXZlbCAiJHtsZXZlbH0iKSIKICBCQVNIX0ZSQU1FV09SS19BUkdTX1ZFUkJPU0U9JHt2ZXJib3NlTGV2ZWx9CiAgQkFTSF9GUkFNRVdPUktfTE9HX0xFVkVMPSR7bG9nTGV2ZWx9Cn0KCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4Kb3B0aW9uTG9nRmlsZUNhbGxiYWNrKCkgewogIGxvY2FsIGxvZ0ZpbGU9IiQyIgogIEJBU0hfRlJBTUVXT1JLX0xPR19GSUxFPSIke2xvZ0ZpbGV9Igp9CgojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIzMTcgIyBpZiBmdW5jdGlvbiBpcyBvdmVycmlkZGVuCm9wdGlvblF1aWV0Q2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfUVVJRVRfTU9ERT0xCn0KCiMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjMxNyAjIGlmIGZ1bmN0aW9uIGlzIG92ZXJyaWRkZW4Kb3B0aW9uTm9Db2xvckNhbGxiYWNrKCkgewogIFVJOjp0aGVtZSAibm9Db2xvciIKfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgpvcHRpb25UaGVtZUNhbGxiYWNrKCkgewogIFVJOjp0aGVtZSAiJDIiCn0KCmRpc3BsYXlDb25maWcoKSB7CiAgZWNobyAiQ29uZmlnIgogIFVJOjpkcmF3TGluZSAiLSIKICBsb2NhbCB2YXIKICB3aGlsZSByZWFkIC1yIHZhcjsgZG8KICAgIHByaW50ZiAnJS00MHMgPSAlc1xuJyAiJHt2YXJ9IiAiJChkZWNsYXJlIC1wICIke3Zhcn0iIHwgc2VkIC1FIC1lICdzL15bXj1dKz0oLiopL1wxLycpIgogIGRvbmUgPCA8KHR5cGVzZXQgLXAgfCBhd2sgJ21hdGNoKCQzLCAiXihCQVNIX0ZSQU1FV09SS19bXj1dKyk9IiwgbSkgeyBwcmludCBtWzFdIH0nIHwgc29ydCkKICBleGl0IDAKfQoKb3B0aW9uQmFzaEZyYW1ld29ya0NvbmZpZ0NhbGxiYWNrKCkgewogIGlmIFtbICEgLWYgIiQyIiBdXTsgdGhlbgogICAgTG9nOjpmYXRhbCAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIEJhc2ggZnJhbWV3b3JrIGNvbmZpZyBmaWxlICckMicgZG9lcyBub3QgZXhpc3RzIgogIGZpCn0KCmRlZmF1bHRGcmFtZXdvcmtDb25maWc9IiQoCiAgY2F0IDw8J0VPRicKIyBjb3BpZWQgZnJvbSBzcmMvX2luY2x1ZGVzLy5mcmFtZXdvcmstY29uZmlnLmRlZmF1bHQKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CgpSRUFMX1NDUklQVF9GSUxFPSIke1JFQUxfU0NSSVBUX0ZJTEU6LSQocmVhZGxpbmsgLWUgIiQocmVhbHBhdGggIiR7QkFTSF9TT1VSQ0VbMF19IikiKX0iCkZSQU1FV09SS19ST09UX0RJUj0iJHtGUkFNRVdPUktfUk9PVF9ESVI6LSQoY2QgIiQocmVhZGxpbmsgLWUgIiR7UkVBTF9TQ1JJUFRfRklMRSUvKn0iKS8uLi8uLiIgJiYgcHdkIC1QKX0iCkZSQU1FV09SS19TUkNfRElSPSIke0ZSQU1FV09SS19TUkNfRElSOi0ke0ZSQU1FV09SS19ST09UX0RJUn0vc3JjfSIKRlJBTUVXT1JLX0JJTl9ESVI9IiR7RlJBTUVXT1JLX0JJTl9ESVI6LSR7RlJBTUVXT1JLX1JPT1RfRElSfS9iaW59IgpGUkFNRVdPUktfVkVORE9SX0RJUj0iJHtGUkFNRVdPUktfVkVORE9SX0RJUjotJHtGUkFNRVdPUktfUk9PVF9ESVJ9L3ZlbmRvcn0iCkZSQU1FV09SS19WRU5ET1JfQklOX0RJUj0iJHtGUkFNRVdPUktfVkVORE9SX0JJTl9ESVI6LSR7RlJBTUVXT1JLX1JPT1RfRElSfS92ZW5kb3IvYmlufSIKCiMgZGVzY3JpYmUgdGhlIGZ1bmN0aW9ucyB0aGF0IHdpbGwgYmUgc2tpcHBlZCBmcm9tIGJlaW5nIGltcG9ydGVkCkZSQU1FV09SS19GVU5DVElPTlNfSUdOT1JFX1JFR0VYUD0iJHtGUkFNRVdPUktfRlVOQ1RJT05TX0lHTk9SRV9SRUdFWFA6LV4oTmFtZXNwYWNlOjpmdW5jdGlvbnN8RnVuY3Rpb25zOjpteUZ1bmN0aW9ufE5hbWVzcGFjZTo6cmVxdWlyZVNvbWV0aGluZ3xBY3F1aXJlOjpGb3JjZUlQdjQpJH0iCiMgZGVzY3JpYmUgdGhlIGZpbGVzIHRoYXQgZG8gbm90IGNvbnRhaW4gZnVuY3Rpb24gdG8gYmUgaW1wb3J0ZWQKTk9OX0ZSQU1FV09SS19GSUxFU19SRUdFWFA9IiR7Tk9OX0ZSQU1FV09SS19GSUxFU19SRUdFWFA6LSheYmluL3wuZnJhbWV3b3JrLWNvbmZpZ3wuYmF0cyR8L3Rlc3RzRGF0YS98Xm1hbnVhbFRlc3RzL3wvXy5zaCR8L1paWi5zaCR8L19fYWxsLnNoJHxec3JjL19iaW5hcmllc3xec3JjL19pbmNsdWRlc3xec3JjL2JhdHNIZWFkZXJzLnNoJHxec3JjL19zdGFuZGFsb25lKX0iCiMgZGVzY3JpYmUgdGhlIGZpbGVzIHRoYXQgYXJlIGFsbG93ZWQgdG8gbm90IGhhdmUgYW4gYXNzb2NpYXRlZCBiYXRzIGZpbGUKQkFUU19GSUxFX05PVF9ORUVERURfUkVHRVhQPSIke0JBVFNfRklMRV9OT1RfTkVFREVEX1JFR0VYUDotKF5iaW4vfC5mcmFtZXdvcmstY29uZmlnfC5iYXRzJHwvdGVzdHNEYXRhL3xebWFudWFsVGVzdHMvfC9fLnNoJHwvWlpaLnNoJHwvX19hbGwuc2gkfF5zcmMvYmF0c0hlYWRlcnMuc2gkfF5zcmMvX2luY2x1ZGVzKX0iCiMgZGVzY3JpYmUgdGhlIGZpbGVzIHRoYXQgYXJlIGFsbG93ZWQgdG8gbm90IGhhdmUgYSBmdW5jdGlvbiBtYXRjaGluZyB0aGUgZmlsZW5hbWUKRlJBTUVXT1JLX0ZJTEVTX0ZVTkNUSU9OX01BVENISU5HX0lHTk9SRV9SRUdFWFA9IiR7RlJBTUVXT1JLX0ZJTEVTX0ZVTkNUSU9OX01BVENISU5HX0lHTk9SRV9SRUdFWFA6LV5iaW4vfF5cLmZyYW1ld29yay1jb25maWckfF5idWlsZC5zaCR8XC50cGwkfC90ZXN0c0RhdGEvfF5tYW51YWxUZXN0cy98XC5iYXRzJH0iCiMgU291cmNlIGRpcmVjdG9yaWVzCmlmIFtbICEgLXYgRlJBTUVXT1JLX1NSQ19ESVJTIF1dOyB0aGVuCiAgRlJBTUVXT1JLX1NSQ19ESVJTPSgKICAgICIke0ZSQU1FV09SS19ST09UX0RJUn0vc3JjIgogICkKZmkKCiMgZXhwb3J0IGhlcmUgYWxsIHRoZSB2YXJpYWJsZXMgdGhhdCB3aWxsIGJlIHVzZWQgaW4geW91ciB0ZW1wbGF0ZXMKZXhwb3J0IFJFUE9TSVRPUllfVVJMPSIke1JFUE9TSVRPUllfVVJMOi1odHRwczovL2dpdGh1Yi5jb20vZmNoYXN0YW5ldC9iYXNoLXRvb2xzLWZyYW1ld29ya30iCgpCQVNIX0ZSQU1FV09SS19USEVNRT0iJHtCQVNIX0ZSQU1FV09SS19USEVNRTotZGVmYXVsdH0iCkJBU0hfRlJBTUVXT1JLX0xPR19MRVZFTD0iJHtCQVNIX0ZSQU1FV09SS19MT0dfTEVWRUw6LTB9IgpCQVNIX0ZSQU1FV09SS19ESVNQTEFZX0xFVkVMPSIke0JBU0hfRlJBTUVXT1JLX0RJU1BMQVlfTEVWRUw6LTN9IgpCQVNIX0ZSQU1FV09SS19MT0dfRklMRT0iJHtCQVNIX0ZSQU1FV09SS19MT0dfRklMRTotJHtGUkFNRVdPUktfUk9PVF9ESVJ9L2xvZ3MvJChiYXNlbmFtZSAiJDAiKS5sb2d9IgpCQVNIX0ZSQU1FV09SS19MT0dfRklMRV9NQVhfUk9UQVRJT049IiR7QkFTSF9GUkFNRVdPUktfTE9HX0ZJTEVfTUFYX1JPVEFUSU9OOi01fSIKRU9GCikiCgpjb21tYW5kT3B0aW9uUGFyc2VGaW5pc2hlZCgpIHsKICAjIGxvYWQgZGVmYXVsdCB0ZW1wbGF0ZSBmcmFtZXdvcmsgY29uZmlnCiAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgZGVmYXVsdEVudkZpbGU9IiR7UEVSU0lTVEVOVF9UTVBESVJ9Ly5mcmFtZXdvcmstY29uZmlnIgogIGVjaG8gIiR7ZGVmYXVsdEZyYW1ld29ya0NvbmZpZ30iID4gIiR7ZGVmYXVsdEVudkZpbGV9IgoKICBFbnY6OnJlcXVpcmVMb2FkICIke2RlZmF1bHRFbnZGaWxlfSIKICBMb2c6OnJlcXVpcmVMb2FkCgogIGlmIFtbICIke29wdGlvbkNvbmZpZ30iID0gIjEiIF1dOyB0aGVuCiAgICBkaXNwbGF5Q29uZmlnCiAgZmkKfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVPcHRpb25WZW5kb3JDYWxsYmFjaygpIHsKICBCQVNIX0ZSQU1FV09SS19BUkdWX0ZJTFRFUkVEKz0oIiQxIiAiJDIiKQp9CgojIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIzMTcgIyBpZiBmdW5jdGlvbiBpcyBvdmVycmlkZGVuCnVwZGF0ZU9wdGlvbkJhc2hWZXJzaW9uQ2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfQVJHVl9GSUxURVJFRCs9KCIkMSIgIiQyIikKfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVPcHRpb25CYXNoQmFzZUltYWdlQ2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfQVJHVl9GSUxURVJFRCs9KCIkMSIgIiQyIikKfQoKIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMzE3ICMgaWYgZnVuY3Rpb24gaXMgb3ZlcnJpZGRlbgp1cGRhdGVPcHRpb25CcmFuY2hOYW1lQ2FsbGJhY2soKSB7CiAgQkFTSF9GUkFNRVdPUktfQVJHVl9GSUxURVJFRCs9KCIkMSIgIiQyIikKfQoKZGVjbGFyZSBvcHRpb25WZW5kb3I9InVidW50dSIKZGVjbGFyZSBvcHRpb25CYXNoVmVyc2lvbj0iNS4xIgpkZWNsYXJlIG9wdGlvbkJhc2hCYXNlSW1hZ2U9InVidW50dToyMC4wNCIKCmJ1aWxkUHVzaERvY2tlckltYWdlQ29tbWFuZCgpIHsKICBsb2NhbCBvcHRpb25zX3BhcnNlX2NtZD0iJDEiCiAgc2hpZnQgfHwgdHJ1ZQoKICBpZiBbWyAiJHtvcHRpb25zX3BhcnNlX2NtZH0iID0gInBhcnNlIiBdXTsgdGhlbgogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblZlbmRvcgogICAgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uVmVuZG9yID0gMCkpIHx8IHRydWUKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CYXNoVmVyc2lvbgogICAgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uQmFzaFZlcnNpb24gPSAwKSkgfHwgdHJ1ZQogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkJhc2hCYXNlSW1hZ2UKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkJhc2hCYXNlSW1hZ2UgPSAwKSkgfHwgdHJ1ZQogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkJyYW5jaE5hbWUKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkJyYW5jaE5hbWUgPSAwKSkgfHwgdHJ1ZQogICAgb3B0aW9uUHVzaD0iMCIKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25QdXNoCiAgICAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25QdXNoID0gMCkpIHx8IHRydWUKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CYXNoRnJhbWV3b3JrQ29uZmlnCiAgICAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CYXNoRnJhbWV3b3JrQ29uZmlnID0gMCkpIHx8IHRydWUKICAgIG9wdGlvbkNvbmZpZz0iMCIKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25Db25maWcKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkNvbmZpZyA9IDApKSB8fCB0cnVlCiAgICBvcHRpb25JbmZvVmVyYm9zZT0iMCIKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25JbmZvVmVyYm9zZQogICAgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uSW5mb1ZlcmJvc2UgPSAwKSkgfHwgdHJ1ZQogICAgb3B0aW9uRGVidWdWZXJib3NlPSIwIgogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkRlYnVnVmVyYm9zZQogICAgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uRGVidWdWZXJib3NlID0gMCkpIHx8IHRydWUKICAgIG9wdGlvblRyYWNlVmVyYm9zZT0iMCIKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25UcmFjZVZlcmJvc2UKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblRyYWNlVmVyYm9zZSA9IDApKSB8fCB0cnVlCiAgICBvcHRpb25Ob0NvbG9yPSIwIgogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbk5vQ29sb3IKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbk5vQ29sb3IgPSAwKSkgfHwgdHJ1ZQogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblRoZW1lCiAgICAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25UaGVtZSA9IDApKSB8fCB0cnVlCiAgICBvcHRpb25IZWxwPSIwIgogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkhlbHAKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkhlbHAgPSAwKSkgfHwgdHJ1ZQogICAgb3B0aW9uVmVyc2lvbj0iMCIKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25WZXJzaW9uCiAgICAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25WZXJzaW9uID0gMCkpIHx8IHRydWUKICAgIG9wdGlvblF1aWV0PSIwIgogICAgbG9jYWwgLWkgb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblF1aWV0CiAgICAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25RdWlldCA9IDApKSB8fCB0cnVlCiAgICBsb2NhbCAtaSBvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uTG9nTGV2ZWwKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkxvZ0xldmVsID0gMCkpIHx8IHRydWUKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25Mb2dGaWxlCiAgICAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25Mb2dGaWxlID0gMCkpIHx8IHRydWUKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25EaXNwbGF5TGV2ZWwKICAgICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkRpc3BsYXlMZXZlbCA9IDApKSB8fCB0cnVlCiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKICAgIGxvY2FsIC1pIG9wdGlvbnNfcGFyc2VfcGFyc2VkQXJnSW5kZXg9MAogICAgd2hpbGUgKCgkIyA+IDApKTsgZG8KICAgICAgbG9jYWwgb3B0aW9uc19wYXJzZV9hcmc9IiQxIgogICAgICBsb2NhbCBhcmdPcHREZWZhdWx0QmVoYXZpb3I9MAogICAgICBjYXNlICIke29wdGlvbnNfcGFyc2VfYXJnfSIgaW4KICAgICAgICAjIE9wdGlvbiAxLzE5CiAgICAgICAgIyBPcHRpb24gb3B0aW9uVmVuZG9yIC0tdmVuZG9yIHZhcmlhYmxlVHlwZSBTdHJpbmcgbWluIDAgbWF4IDEgYXV0aG9yaXplZFZhbHVlcyAnYWxwaW5lfHVidW50dScgcmVnZXhwICcnCiAgICAgICAgLS12ZW5kb3IpCiAgICAgICAgICBzaGlmdAogICAgICAgICAgaWYgKCgkIyA9PSAwKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBhIHZhbHVlIG5lZWRzIHRvIGJlIHNwZWNpZmllZCIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICBpZiBbWyAhICIkMSIgPX4gYWxwaW5lfHVidW50dSBdXTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIHZhbHVlICckMScgaXMgbm90IHBhcnQgb2YgYXV0aG9yaXplZCB2YWx1ZXMoYWxwaW5lfHVidW50dSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgaWYgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uVmVuZG9yID49IDEpKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIE1heGltdW0gbnVtYmVyIG9mIG9wdGlvbiBvY2N1cnJlbmNlcyByZWFjaGVkKDEpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgICgoKytvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uVmVuZG9yKSkKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uVmVuZG9yPSIkMSIKICAgICAgICAgIHVwZGF0ZU9wdGlvblZlbmRvckNhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIgIiR7b3B0aW9uVmVuZG9yfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gMi8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvbkJhc2hWZXJzaW9uIC0tYmFzaC12ZXJzaW9uIHZhcmlhYmxlVHlwZSBTdHJpbmcgbWluIDAgbWF4IDEgYXV0aG9yaXplZFZhbHVlcyAnNC40fDUuMHw1LjF8NS4yJyByZWdleHAgJycKICAgICAgICAtLWJhc2gtdmVyc2lvbikKICAgICAgICAgIHNoaWZ0CiAgICAgICAgICBpZiAoKCQjID09IDApKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIGEgdmFsdWUgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgIGlmIFtbICEgIiQxIiA9fiA0LjR8NS4wfDUuMXw1LjIgXV07IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSB2YWx1ZSAnJDEnIGlzIG5vdCBwYXJ0IG9mIGF1dGhvcml6ZWQgdmFsdWVzKDQuNHw1LjB8NS4xfDUuMikiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgaWYgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uQmFzaFZlcnNpb24gPj0gMSkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gTWF4aW11bSBudW1iZXIgb2Ygb3B0aW9uIG9jY3VycmVuY2VzIHJlYWNoZWQoMSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgKCgrK29wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CYXNoVmVyc2lvbikpCiAgICAgICAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKICAgICAgICAgIG9wdGlvbkJhc2hWZXJzaW9uPSIkMSIKICAgICAgICAgIHVwZGF0ZU9wdGlvbkJhc2hWZXJzaW9uQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25CYXNoVmVyc2lvbn0iCiAgICAgICAgICA7OwogICAgICAgICMgT3B0aW9uIDMvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25CYXNoQmFzZUltYWdlIC0tYmFzaC1iYXNlLWltYWdlIHZhcmlhYmxlVHlwZSBTdHJpbmcgbWluIDAgbWF4IDEgYXV0aG9yaXplZFZhbHVlcyAnJyByZWdleHAgJycKICAgICAgICAtLWJhc2gtYmFzZS1pbWFnZSkKICAgICAgICAgIHNoaWZ0CiAgICAgICAgICBpZiAoKCQjID09IDApKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIGEgdmFsdWUgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkJhc2hCYXNlSW1hZ2UgPj0gMSkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gTWF4aW11bSBudW1iZXIgb2Ygb3B0aW9uIG9jY3VycmVuY2VzIHJlYWNoZWQoMSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgKCgrK29wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CYXNoQmFzZUltYWdlKSkKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uQmFzaEJhc2VJbWFnZT0iJDEiCiAgICAgICAgICB1cGRhdGVPcHRpb25CYXNoQmFzZUltYWdlQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25CYXNoQmFzZUltYWdlfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gNC8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvbkJyYW5jaE5hbWUgLS1icmFuY2gtbmFtZSB2YXJpYWJsZVR5cGUgU3RyaW5nIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1icmFuY2gtbmFtZSkKICAgICAgICAgIHNoaWZ0CiAgICAgICAgICBpZiAoKCQjID09IDApKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIGEgdmFsdWUgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkJyYW5jaE5hbWUgPj0gMSkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gTWF4aW11bSBudW1iZXIgb2Ygb3B0aW9uIG9jY3VycmVuY2VzIHJlYWNoZWQoMSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgKCgrK29wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CcmFuY2hOYW1lKSkKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uQnJhbmNoTmFtZT0iJDEiCiAgICAgICAgICB1cGRhdGVPcHRpb25CcmFuY2hOYW1lQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25CcmFuY2hOYW1lfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gNS8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvblB1c2ggLS1wdXNoIHZhcmlhYmxlVHlwZSBCb29sZWFuIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1wdXNoKQogICAgICAgICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgICAgICAgICBvcHRpb25QdXNoPSIxIgogICAgICAgICAgaWYgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uUHVzaCA+PSAxKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBNYXhpbXVtIG51bWJlciBvZiBvcHRpb24gb2NjdXJyZW5jZXMgcmVhY2hlZCgxKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblB1c2gpKQogICAgICAgICAgOzsKICAgICAgICAjIE9wdGlvbiA2LzE5CiAgICAgICAgIyBPcHRpb24gb3B0aW9uQmFzaEZyYW1ld29ya0NvbmZpZyAtLWJhc2gtZnJhbWV3b3JrLWNvbmZpZyB2YXJpYWJsZVR5cGUgU3RyaW5nIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1iYXNoLWZyYW1ld29yay1jb25maWcpCiAgICAgICAgICBzaGlmdAogICAgICAgICAgaWYgKCgkIyA9PSAwKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBhIHZhbHVlIG5lZWRzIHRvIGJlIHNwZWNpZmllZCIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICBpZiAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25CYXNoRnJhbWV3b3JrQ29uZmlnID49IDEpKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIE1heGltdW0gbnVtYmVyIG9mIG9wdGlvbiBvY2N1cnJlbmNlcyByZWFjaGVkKDEpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgICgoKytvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uQmFzaEZyYW1ld29ya0NvbmZpZykpCiAgICAgICAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKICAgICAgICAgIG9wdGlvbkJhc2hGcmFtZXdvcmtDb25maWc9IiQxIgogICAgICAgICAgb3B0aW9uQmFzaEZyYW1ld29ya0NvbmZpZ0NhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIgIiR7b3B0aW9uQmFzaEZyYW1ld29ya0NvbmZpZ30iCiAgICAgICAgICA7OwogICAgICAgICMgT3B0aW9uIDcvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25Db25maWcgLS1jb25maWcgdmFyaWFibGVUeXBlIEJvb2xlYW4gbWluIDAgbWF4IDEgYXV0aG9yaXplZFZhbHVlcyAnJyByZWdleHAgJycKICAgICAgICAtLWNvbmZpZykKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uQ29uZmlnPSIxIgogICAgICAgICAgaWYgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uQ29uZmlnID49IDEpKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIE1heGltdW0gbnVtYmVyIG9mIG9wdGlvbiBvY2N1cnJlbmNlcyByZWFjaGVkKDEpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgICgoKytvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uQ29uZmlnKSkKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gOC8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvbkluZm9WZXJib3NlIC0tdmVyYm9zZXwtdiB2YXJpYWJsZVR5cGUgQm9vbGVhbiBtaW4gMCBtYXggMSBhdXRob3JpemVkVmFsdWVzICcnIHJlZ2V4cCAnJwogICAgICAgIC0tdmVyYm9zZSB8IC12KQogICAgICAgICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgICAgICAgICBvcHRpb25JbmZvVmVyYm9zZT0iMSIKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkluZm9WZXJib3NlID49IDEpKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIE1heGltdW0gbnVtYmVyIG9mIG9wdGlvbiBvY2N1cnJlbmNlcyByZWFjaGVkKDEpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgICgoKytvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uSW5mb1ZlcmJvc2UpKQogICAgICAgICAgb3B0aW9uSW5mb1ZlcmJvc2VDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICB1cGRhdGVBcmdMaXN0SW5mb1ZlcmJvc2VDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICA7OwogICAgICAgICMgT3B0aW9uIDkvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25EZWJ1Z1ZlcmJvc2UgLXZ2IHZhcmlhYmxlVHlwZSBCb29sZWFuIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLXZ2KQogICAgICAgICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgICAgICAgICBvcHRpb25EZWJ1Z1ZlcmJvc2U9IjEiCiAgICAgICAgICBpZiAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25EZWJ1Z1ZlcmJvc2UgPj0gMSkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gTWF4aW11bSBudW1iZXIgb2Ygb3B0aW9uIG9jY3VycmVuY2VzIHJlYWNoZWQoMSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgKCgrK29wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25EZWJ1Z1ZlcmJvc2UpKQogICAgICAgICAgb3B0aW9uRGVidWdWZXJib3NlQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IgogICAgICAgICAgdXBkYXRlQXJnTGlzdERlYnVnVmVyYm9zZUNhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gMTAvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25UcmFjZVZlcmJvc2UgLXZ2diB2YXJpYWJsZVR5cGUgQm9vbGVhbiBtaW4gMCBtYXggMSBhdXRob3JpemVkVmFsdWVzICcnIHJlZ2V4cCAnJwogICAgICAgIC12dnYpCiAgICAgICAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKICAgICAgICAgIG9wdGlvblRyYWNlVmVyYm9zZT0iMSIKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblRyYWNlVmVyYm9zZSA+PSAxKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBNYXhpbXVtIG51bWJlciBvZiBvcHRpb24gb2NjdXJyZW5jZXMgcmVhY2hlZCgxKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblRyYWNlVmVyYm9zZSkpCiAgICAgICAgICBvcHRpb25UcmFjZVZlcmJvc2VDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICB1cGRhdGVBcmdMaXN0VHJhY2VWZXJib3NlQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IgogICAgICAgICAgOzsKICAgICAgICAjIE9wdGlvbiAxMS8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvbkVudkZpbGVzIC0tZW52LWZpbGUgdmFyaWFibGVUeXBlIFN0cmluZ0FycmF5IG1pbiAwIG1heCAtMSBhdXRob3JpemVkVmFsdWVzICcnIHJlZ2V4cCAnJwogICAgICAgIC0tZW52LWZpbGUpCiAgICAgICAgICBzaGlmdAogICAgICAgICAgaWYgKCgkIyA9PSAwKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBhIHZhbHVlIG5lZWRzIHRvIGJlIHNwZWNpZmllZCIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkVudkZpbGVzKSkKICAgICAgICAgIG9wdGlvbkVudkZpbGVzKz0oIiQxIikKICAgICAgICAgIG9wdGlvbkVudkZpbGVDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iICIke29wdGlvbkVudkZpbGVzW0BdfSIKICAgICAgICAgIHVwZGF0ZUFyZ0xpc3RFbnZGaWxlQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25FbnZGaWxlc1tAXX0iCiAgICAgICAgICA7OwogICAgICAgICMgT3B0aW9uIDEyLzE5CiAgICAgICAgIyBPcHRpb24gb3B0aW9uTm9Db2xvciAtLW5vLWNvbG9yIHZhcmlhYmxlVHlwZSBCb29sZWFuIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1uby1jb2xvcikKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uTm9Db2xvcj0iMSIKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbk5vQ29sb3IgPj0gMSkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gTWF4aW11bSBudW1iZXIgb2Ygb3B0aW9uIG9jY3VycmVuY2VzIHJlYWNoZWQoMSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgKCgrK29wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25Ob0NvbG9yKSkKICAgICAgICAgIG9wdGlvbk5vQ29sb3JDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICB1cGRhdGVBcmdMaXN0Tm9Db2xvckNhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gMTMvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25UaGVtZSAtLXRoZW1lIHZhcmlhYmxlVHlwZSBTdHJpbmcgbWluIDAgbWF4IDEgYXV0aG9yaXplZFZhbHVlcyAnZGVmYXVsdHxkZWZhdWx0LWZvcmNlfG5vQ29sb3InIHJlZ2V4cCAnJwogICAgICAgIC0tdGhlbWUpCiAgICAgICAgICBzaGlmdAogICAgICAgICAgaWYgKCgkIyA9PSAwKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBhIHZhbHVlIG5lZWRzIHRvIGJlIHNwZWNpZmllZCIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICBpZiBbWyAhICIkMSIgPX4gZGVmYXVsdHxkZWZhdWx0LWZvcmNlfG5vQ29sb3IgXV07IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSB2YWx1ZSAnJDEnIGlzIG5vdCBwYXJ0IG9mIGF1dGhvcml6ZWQgdmFsdWVzKGRlZmF1bHR8ZGVmYXVsdC1mb3JjZXxub0NvbG9yKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICBpZiAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25UaGVtZSA+PSAxKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBNYXhpbXVtIG51bWJlciBvZiBvcHRpb24gb2NjdXJyZW5jZXMgcmVhY2hlZCgxKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblRoZW1lKSkKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uVGhlbWU9IiQxIgogICAgICAgICAgb3B0aW9uVGhlbWVDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iICIke29wdGlvblRoZW1lfSIKICAgICAgICAgIHVwZGF0ZUFyZ0xpc3RUaGVtZUNhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIgIiR7b3B0aW9uVGhlbWV9IgogICAgICAgICAgOzsKICAgICAgICAjIE9wdGlvbiAxNC8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvbkhlbHAgLS1oZWxwfC1oIHZhcmlhYmxlVHlwZSBCb29sZWFuIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1oZWxwIHwgLWgpCiAgICAgICAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKICAgICAgICAgIG9wdGlvbkhlbHA9IjEiCiAgICAgICAgICBpZiAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25IZWxwID49IDEpKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIE1heGltdW0gbnVtYmVyIG9mIG9wdGlvbiBvY2N1cnJlbmNlcyByZWFjaGVkKDEpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgICgoKytvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uSGVscCkpCiAgICAgICAgICBvcHRpb25IZWxwQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IgogICAgICAgICAgOzsKICAgICAgICAjIE9wdGlvbiAxNS8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvblZlcnNpb24gLS12ZXJzaW9uIHZhcmlhYmxlVHlwZSBCb29sZWFuIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS12ZXJzaW9uKQogICAgICAgICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgICAgICAgICBvcHRpb25WZXJzaW9uPSIxIgogICAgICAgICAgaWYgKChvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uVmVyc2lvbiA+PSAxKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBNYXhpbXVtIG51bWJlciBvZiBvcHRpb24gb2NjdXJyZW5jZXMgcmVhY2hlZCgxKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblZlcnNpb24pKQogICAgICAgICAgb3B0aW9uVmVyc2lvbkNhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gMTYvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25RdWlldCAtLXF1aWV0fC1xIHZhcmlhYmxlVHlwZSBCb29sZWFuIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1xdWlldCB8IC1xKQogICAgICAgICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDM0CiAgICAgICAgICBvcHRpb25RdWlldD0iMSIKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvblF1aWV0ID49IDEpKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIE1heGltdW0gbnVtYmVyIG9mIG9wdGlvbiBvY2N1cnJlbmNlcyByZWFjaGVkKDEpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgICgoKytvcHRpb25zX3BhcnNlX29wdGlvblBhcnNlZENvdW50T3B0aW9uUXVpZXQpKQogICAgICAgICAgb3B0aW9uUXVpZXRDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICB1cGRhdGVBcmdMaXN0UXVpZXRDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICA7OwogICAgICAgICMgT3B0aW9uIDE3LzE5CiAgICAgICAgIyBPcHRpb24gb3B0aW9uTG9nTGV2ZWwgLS1sb2ctbGV2ZWwgdmFyaWFibGVUeXBlIFN0cmluZyBtaW4gMCBtYXggMSBhdXRob3JpemVkVmFsdWVzICdPRkZ8RVJST1J8V0FSTklOR3xJTkZPfERFQlVHfFRSQUNFJyByZWdleHAgJycKICAgICAgICAtLWxvZy1sZXZlbCkKICAgICAgICAgIHNoaWZ0CiAgICAgICAgICBpZiAoKCQjID09IDApKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIGEgdmFsdWUgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgIGlmIFtbICEgIiQxIiA9fiBPRkZ8RVJST1J8V0FSTklOR3xJTkZPfERFQlVHfFRSQUNFIF1dOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gdmFsdWUgJyQxJyBpcyBub3QgcGFydCBvZiBhdXRob3JpemVkIHZhbHVlcyhPRkZ8RVJST1J8V0FSTklOR3xJTkZPfERFQlVHfFRSQUNFKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICBpZiAoKG9wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25Mb2dMZXZlbCA+PSAxKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBNYXhpbXVtIG51bWJlciBvZiBvcHRpb24gb2NjdXJyZW5jZXMgcmVhY2hlZCgxKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkxvZ0xldmVsKSkKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uTG9nTGV2ZWw9IiQxIgogICAgICAgICAgb3B0aW9uTG9nTGV2ZWxDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iICIke29wdGlvbkxvZ0xldmVsfSIKICAgICAgICAgIHVwZGF0ZUFyZ0xpc3RMb2dMZXZlbENhbGxiYWNrICIke29wdGlvbnNfcGFyc2VfYXJnfSIgIiR7b3B0aW9uTG9nTGV2ZWx9IgogICAgICAgICAgOzsKICAgICAgICAjIE9wdGlvbiAxOC8xOQogICAgICAgICMgT3B0aW9uIG9wdGlvbkxvZ0ZpbGUgLS1sb2ctZmlsZSB2YXJpYWJsZVR5cGUgU3RyaW5nIG1pbiAwIG1heCAxIGF1dGhvcml6ZWRWYWx1ZXMgJycgcmVnZXhwICcnCiAgICAgICAgLS1sb2ctZmlsZSkKICAgICAgICAgIHNoaWZ0CiAgICAgICAgICBpZiAoKCQjID09IDApKTsgdGhlbgogICAgICAgICAgICBMb2c6OmRpc3BsYXlFcnJvciAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIE9wdGlvbiAke29wdGlvbnNfcGFyc2VfYXJnfSAtIGEgdmFsdWUgbmVlZHMgdG8gYmUgc3BlY2lmaWVkIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkxvZ0ZpbGUgPj0gMSkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gTWF4aW11bSBudW1iZXIgb2Ygb3B0aW9uIG9jY3VycmVuY2VzIHJlYWNoZWQoMSkiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgKCgrK29wdGlvbnNfcGFyc2Vfb3B0aW9uUGFyc2VkQ291bnRPcHRpb25Mb2dGaWxlKSkKICAgICAgICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjAzNAogICAgICAgICAgb3B0aW9uTG9nRmlsZT0iJDEiCiAgICAgICAgICBvcHRpb25Mb2dGaWxlQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25Mb2dGaWxlfSIKICAgICAgICAgIHVwZGF0ZUFyZ0xpc3RMb2dGaWxlQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25Mb2dGaWxlfSIKICAgICAgICAgIDs7CiAgICAgICAgIyBPcHRpb24gMTkvMTkKICAgICAgICAjIE9wdGlvbiBvcHRpb25EaXNwbGF5TGV2ZWwgLS1kaXNwbGF5LWxldmVsIHZhcmlhYmxlVHlwZSBTdHJpbmcgbWluIDAgbWF4IDEgYXV0aG9yaXplZFZhbHVlcyAnT0ZGfEVSUk9SfFdBUk5JTkd8SU5GT3xERUJVR3xUUkFDRScgcmVnZXhwICcnCiAgICAgICAgLS1kaXNwbGF5LWxldmVsKQogICAgICAgICAgc2hpZnQKICAgICAgICAgIGlmICgoJCMgPT0gMCkpOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uICR7b3B0aW9uc19wYXJzZV9hcmd9IC0gYSB2YWx1ZSBuZWVkcyB0byBiZSBzcGVjaWZpZWQiCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgaWYgW1sgISAiJDEiID1+IE9GRnxFUlJPUnxXQVJOSU5HfElORk98REVCVUd8VFJBQ0UgXV07IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSB2YWx1ZSAnJDEnIGlzIG5vdCBwYXJ0IG9mIGF1dGhvcml6ZWQgdmFsdWVzKE9GRnxFUlJPUnxXQVJOSU5HfElORk98REVCVUd8VFJBQ0UpIgogICAgICAgICAgICByZXR1cm4gMQogICAgICAgICAgZmkKICAgICAgICAgIGlmICgob3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkRpc3BsYXlMZXZlbCA+PSAxKSk7IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBPcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30gLSBNYXhpbXVtIG51bWJlciBvZiBvcHRpb24gb2NjdXJyZW5jZXMgcmVhY2hlZCgxKSIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICAoKCsrb3B0aW9uc19wYXJzZV9vcHRpb25QYXJzZWRDb3VudE9wdGlvbkRpc3BsYXlMZXZlbCkpCiAgICAgICAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwMzQKICAgICAgICAgIG9wdGlvbkRpc3BsYXlMZXZlbD0iJDEiCiAgICAgICAgICBvcHRpb25EaXNwbGF5TGV2ZWxDYWxsYmFjayAiJHtvcHRpb25zX3BhcnNlX2FyZ30iICIke29wdGlvbkRpc3BsYXlMZXZlbH0iCiAgICAgICAgICB1cGRhdGVBcmdMaXN0RGlzcGxheUxldmVsQ2FsbGJhY2sgIiR7b3B0aW9uc19wYXJzZV9hcmd9IiAiJHtvcHRpb25EaXNwbGF5TGV2ZWx9IgogICAgICAgICAgOzsKICAgICAgICAtKikKICAgICAgICAgIGlmIFtbICIke2FyZ09wdERlZmF1bHRCZWhhdmlvcn0iID0gIjAiIF1dOyB0aGVuCiAgICAgICAgICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gSW52YWxpZCBvcHRpb24gJHtvcHRpb25zX3BhcnNlX2FyZ30iCiAgICAgICAgICAgIHJldHVybiAxCiAgICAgICAgICBmaQogICAgICAgICAgOzsKICAgICAgICAqKQogICAgICAgICAgaWYgW1sgIiR7YXJnT3B0RGVmYXVsdEJlaGF2aW9yfSIgPSAiMCIgXV07IHRoZW4KICAgICAgICAgICAgTG9nOjpkaXNwbGF5RXJyb3IgIkNvbW1hbmQgJHtTQ1JJUFRfTkFNRX0gLSBBcmd1bWVudCAtIHRvbyBtdWNoIGFyZ3VtZW50cyBwcm92aWRlZCIKICAgICAgICAgICAgcmV0dXJuIDEKICAgICAgICAgIGZpCiAgICAgICAgICA7OwogICAgICBlc2FjCiAgICAgIHNoaWZ0IHx8IHRydWUKICAgIGRvbmUKICAgIGNvbW1hbmRPcHRpb25QYXJzZUZpbmlzaGVkCiAgICBMb2c6OmRpc3BsYXlEZWJ1ZyAiQ29tbWFuZCAke1NDUklQVF9OQU1FfSAtIHBhcnNlIGFyZ3VtZW50czogJHtCQVNIX0ZSQU1FV09SS19BUkdWWypdfSIKICAgIExvZzo6ZGlzcGxheURlYnVnICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gcGFyc2UgZmlsdGVyZWQgYXJndW1lbnRzOiAke0JBU0hfRlJBTUVXT1JLX0FSR1ZfRklMVEVSRURbKl19IgogIGVsaWYgW1sgIiR7b3B0aW9uc19wYXJzZV9jbWR9IiA9ICJoZWxwIiBdXTsgdGhlbgogICAgZWNobyAtZSAiJChBcnJheTo6d3JhcCAiICIgODAgMCAiJHtfX0hFTFBfVElUTEVfQ09MT1J9REVTQ1JJUFRJT046JHtfX1JFU0VUX0NPTE9SfSIgInB1bGwsIGJ1aWxkIGFuZCBwdXNoIGRvY2tlciBpbWFnZQoKLSBwdWxsIHByZXZpb3VzIGRvY2tlciBpbWFnZSBmcm9tIGRvY2tlciBodWIgaWYKICBleGlzdHMKLSBidWlsZCBuZXcgaW1hZ2UgdXNpbmcgcHJldmlvdXMgaW1hZ2UgYXMgY2FjaGUKLSB0YWcgYnVpbHQgaW1hZ2UKLSBwdXNoIGl0IHRvIGRvY2tlciByZWdpc3RyeQoKYWRkaXRpb25hbCBkb2NrZXIgYnVpbGQgb3B0aW9ucyBjYW4gYmUgcGFzc2VkCiAgdmlhICR7X19IRUxQX09QVElPTl9DT0xPUn1ET0NLRVJfQlVJTERfT1BUSU9OUyR7X19IRUxQX05PUk1BTH0gZW52IHZhcmlhYmxlCgpJTlRFUk5BTAoiKSIKICAgIGVjaG8KCiAgICBlY2hvIC1lICIkKEFycmF5Ojp3cmFwICIgIiA4MCAyICIke19fSEVMUF9USVRMRV9DT0xPUn1VU0FHRToke19fUkVTRVRfQ09MT1J9IiAiJHtTQ1JJUFRfTkFNRX0iICJbT1BUSU9OU10iKSIKICAgIGVjaG8gLWUgIiQoQXJyYXk6OndyYXAgIiAiIDgwIDIgIiR7X19IRUxQX1RJVExFX0NPTE9SfVVTQUdFOiR7X19SRVNFVF9DT0xPUn0iIFwKICAgICAgIiR7U0NSSVBUX05BTUV9IiBcCiAgICAgICJbLS12ZW5kb3IgPFN0cmluZz5dIiAiWy0tYmFzaC12ZXJzaW9uIDxTdHJpbmc+XSIgIlstLWJhc2gtYmFzZS1pbWFnZSA8U3RyaW5nPl0iICJbLS1icmFuY2gtbmFtZSA8U3RyaW5nPl0iICJbLS1wdXNoXSIgIlstLWJhc2gtZnJhbWV3b3JrLWNvbmZpZyA8U3RyaW5nPl0iICJbLS1jb25maWddIiAiWy0tdmVyYm9zZXwtdl0iICJbLXZ2XSIgIlstdnZ2XSIgIlstLWVudi1maWxlIDxTdHJpbmc+XSIgIlstLW5vLWNvbG9yXSIgIlstLXRoZW1lIDxTdHJpbmc+XSIgIlstLWhlbHB8LWhdIiAiWy0tdmVyc2lvbl0iICJbLS1xdWlldHwtcV0iICJbLS1sb2ctbGV2ZWwgPFN0cmluZz5dIiAiWy0tbG9nLWZpbGUgPFN0cmluZz5dIiAiWy0tZGlzcGxheS1sZXZlbCA8U3RyaW5nPl0iKSIKICAgIGVjaG8KICAgIGVjaG8gLWUgIiR7X19IRUxQX1RJVExFX0NPTE9SfU9QVElPTlM6JHtfX1JFU0VUX0NPTE9SfSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tdmVuZG9yIDxTdHJpbmc+JHtfX0hFTFBfTk9STUFMfSB7c2luZ2xlfSIKICAgIGxvY2FsIC1hIGhlbHBBcnJheQogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDU0CiAgICBoZWxwQXJyYXk9KHZlbmRvclwgaW1hZ2VcIHRvXCB1c2U6XCBhbHBpbmVcfHVidW50dVwgXChEZWZhdWx0OlwgdWJ1bnR1XCkpCiAgICBlY2hvIC1lICIgICAgJChBcnJheTo6d3JhcCAiICIgNzYgNCAiJHtoZWxwQXJyYXlbQF19IikiCiAgICBlY2hvIC1lICIgICR7X19IRUxQX09QVElPTl9DT0xPUn0tLWJhc2gtdmVyc2lvbiA8U3RyaW5nPiR7X19IRUxQX05PUk1BTH0ge3NpbmdsZX0iCiAgICBsb2NhbCAtYSBoZWxwQXJyYXkKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjA1NAogICAgaGVscEFycmF5PSh2ZXJzaW9uXCBvZlwgYmFzaFwgdG9cIHVzZTpcIDQuNFx8NS4wXHw1LjFcfDUuMlwgXChEZWZhdWx0OlwgNS4xXCkpCiAgICBlY2hvIC1lICIgICAgJChBcnJheTo6d3JhcCAiICIgNzYgNCAiJHtoZWxwQXJyYXlbQF19IikiCiAgICBlY2hvIC1lICIgICR7X19IRUxQX09QVElPTl9DT0xPUn0tLWJhc2gtYmFzZS1pbWFnZSA8U3RyaW5nPiR7X19IRUxQX05PUk1BTH0ge3NpbmdsZX0iCiAgICBsb2NhbCAtYSBoZWxwQXJyYXkKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjA1NAogICAgaGVscEFycmF5PShiYXNoXCBiYXNoXCBpbWFnZVwgdG9cIHVzZVwgXChlZzpcIHVidW50dToyMC4wNFwsXCBhbWQ2NC9iYXNoOjQuNC1hbHBpbmUzLjE4XClcIFwoRGVmYXVsdDpcIHVidW50dToyMC4wNFwpKQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobyAtZSAiICAke19fSEVMUF9PUFRJT05fQ09MT1J9LS1icmFuY2gtbmFtZSA8U3RyaW5nPiR7X19IRUxQX05PUk1BTH0ge3NpbmdsZX0iCiAgICBsb2NhbCAtYSBoZWxwQXJyYXkKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjA1NAogICAgaGVscEFycmF5PShicmFuY2hcIG5hbWVcIGJlaW5nXCBidWlsdFwsXCB3aWxsXCBoZWxwXCB0b1wgY3JlYXRlXCBkb2NrZXJcIGltYWdlXCB0YWdcIG5hbWUpCiAgICBlY2hvIC1lICIgICAgJChBcnJheTo6d3JhcCAiICIgNzYgNCAiJHtoZWxwQXJyYXlbQF19IikiCiAgICBlY2hvIC1lICIgICR7X19IRUxQX09QVElPTl9DT0xPUn0tLXB1c2gke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0oaWZcIHByb3ZpZGVkXCxcIHB1c2hcIHRoZVwgaW1hZ2VcIHRvXCB0aGVcIHJlZ2lzdHJ5KQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobwogICAgZWNobyAtZSAiJHtfX0hFTFBfVElUTEVfQ09MT1J9R0xPQkFMIE9QVElPTlM6JHtfX1JFU0VUX0NPTE9SfSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tYmFzaC1mcmFtZXdvcmstY29uZmlnIDxTdHJpbmc+JHtfX0hFTFBfTk9STUFMfSB7c2luZ2xlfSIKICAgIGxvY2FsIC1hIGhlbHBBcnJheQogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDU0CiAgICBoZWxwQXJyYXk9KHVzZVwgYWx0ZXJuYXRlXCBiYXNoXCBmcmFtZXdvcmtcIGNvbmZpZ3VyYXRpb24uKQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobyAtZSAiICAke19fSEVMUF9PUFRJT05fQ09MT1J9LS1jb25maWcke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0oRGlzcGxheVwgY29uZmlndXJhdGlvbikKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tdmVyYm9zZSR7X19IRUxQX05PUk1BTH0sICR7X19IRUxQX09QVElPTl9DT0xPUn0tdiR7X19IRUxQX05PUk1BTH0ge3NpbmdsZX0iCiAgICBsb2NhbCAtYSBoZWxwQXJyYXkKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjA1NAogICAgaGVscEFycmF5PShpbmZvXCBsZXZlbFwgdmVyYm9zZVwgbW9kZVwgXChhbGlhc1wgb2ZcIC0tZGlzcGxheS1sZXZlbFwgSU5GT1wpKQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobyAtZSAiICAke19fSEVMUF9PUFRJT05fQ09MT1J9LXZ2JHtfX0hFTFBfTk9STUFMfSB7c2luZ2xlfSIKICAgIGxvY2FsIC1hIGhlbHBBcnJheQogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDU0CiAgICBoZWxwQXJyYXk9KGRlYnVnXCBsZXZlbFwgdmVyYm9zZVwgbW9kZVwgXChhbGlhc1wgb2ZcIC0tZGlzcGxheS1sZXZlbFwgREVCVUdcKSkKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS12dnYke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0odHJhY2VcIGxldmVsXCB2ZXJib3NlXCBtb2RlXCBcKGFsaWFzXCBvZlwgLS1kaXNwbGF5LWxldmVsXCBUUkFDRVwpKQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobyAtZSAiICAke19fSEVMUF9PUFRJT05fQ09MT1J9LS1lbnYtZmlsZSA8U3RyaW5nPiR7X19IRUxQX05PUk1BTH0ge2xpc3R9IChvcHRpb25hbCkiCiAgICBsb2NhbCAtYSBoZWxwQXJyYXkKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjA1NAogICAgaGVscEFycmF5PShMb2FkXCB0aGVcIHNwZWNpZmllZFwgZW52XCBmaWxlXCBcKGRlcHJlY2F0ZWRcLFwgcGxlYXNlXCB1c2VcIC0tYmFzaC1mcmFtZXdvcmstY29uZmlnXCBvcHRpb25cIGluc3RlYWRcKSkKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tbm8tY29sb3Ike19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0oUHJvZHVjZVwgbW9ub2Nocm9tZVwgb3V0cHV0LlwgYWxpYXNcIG9mXCAtLXRoZW1lXCBub0NvbG9yLikKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tdGhlbWUgPFN0cmluZz4ke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0oY2hvb3NlXCBjb2xvclwgdGhlbWVcIFwoZGVmYXVsdFwsXCBkZWZhdWx0LWZvcmNlXCBvclwgbm9Db2xvclwpXCAtXCBkZWZhdWx0LWZvcmNlXCBtZWFuc1wgY29sb3JzXCB3aWxsXCBiZVwgcHJvZHVjZWRcIGV2ZW5cIGlmXCBjb21tYW5kXCBpc1wgcGlwZWQpCiAgICBlY2hvIC1lICIgICAgJChBcnJheTo6d3JhcCAiICIgNzYgNCAiJHtoZWxwQXJyYXlbQF19IikiCiAgICBlY2hvIC1lICIgICR7X19IRUxQX09QVElPTl9DT0xPUn0tLWhlbHAke19fSEVMUF9OT1JNQUx9LCAke19fSEVMUF9PUFRJT05fQ09MT1J9LWgke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0oRGlzcGxheVwgdGhpc1wgY29tbWFuZFwgaGVscCkKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tdmVyc2lvbiR7X19IRUxQX05PUk1BTH0ge3NpbmdsZX0iCiAgICBsb2NhbCAtYSBoZWxwQXJyYXkKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjA1NAogICAgaGVscEFycmF5PShQcmludFwgdmVyc2lvblwgaW5mb3JtYXRpb25cIGFuZFwgcXVpdCkKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8gLWUgIiAgJHtfX0hFTFBfT1BUSU9OX0NPTE9SfS0tcXVpZXQke19fSEVMUF9OT1JNQUx9LCAke19fSEVMUF9PUFRJT05fQ09MT1J9LXEke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0ocXVpZXRcIG1vZGVcLFwgZG9lc25cJ3RcIGRpc3BsYXlcIGFueVwgb3V0cHV0KQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobyAtZSAiICAke19fSEVMUF9PUFRJT05fQ09MT1J9LS1sb2ctbGV2ZWwgPFN0cmluZz4ke19fSEVMUF9OT1JNQUx9IHtzaW5nbGV9IgogICAgbG9jYWwgLWEgaGVscEFycmF5CiAgICAjIHNoZWxsY2hlY2sgZGlzYWJsZT1TQzIwNTQKICAgIGhlbHBBcnJheT0oU2V0XCBsb2dcIGxldmVsXCBcKG9uZVwgb2ZcIE9GRlwsXCBFUlJPUlwsXCBXQVJOSU5HXCxcIElORk9cLFwgREVCVUdcLFwgVFJBQ0VcIHZhbHVlXCkpCiAgICBlY2hvIC1lICIgICAgJChBcnJheTo6d3JhcCAiICIgNzYgNCAiJHtoZWxwQXJyYXlbQF19IikiCiAgICBlY2hvIC1lICIgICR7X19IRUxQX09QVElPTl9DT0xPUn0tLWxvZy1maWxlIDxTdHJpbmc+JHtfX0hFTFBfTk9STUFMfSB7c2luZ2xlfSIKICAgIGxvY2FsIC1hIGhlbHBBcnJheQogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDU0CiAgICBoZWxwQXJyYXk9KFNldFwgbG9nXCBmaWxlKQogICAgZWNobyAtZSAiICAgICQoQXJyYXk6OndyYXAgIiAiIDc2IDQgIiR7aGVscEFycmF5W0BdfSIpIgogICAgZWNobyAtZSAiICAke19fSEVMUF9PUFRJT05fQ09MT1J9LS1kaXNwbGF5LWxldmVsIDxTdHJpbmc+JHtfX0hFTFBfTk9STUFMfSB7c2luZ2xlfSIKICAgIGxvY2FsIC1hIGhlbHBBcnJheQogICAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDU0CiAgICBoZWxwQXJyYXk9KHNldFwgZGlzcGxheVwgbGV2ZWxcIFwob25lXCBvZlwgT0ZGXCxcIEVSUk9SXCxcIFdBUk5JTkdcLFwgSU5GT1wsXCBERUJVR1wsXCBUUkFDRVwgdmFsdWVcKSkKICAgIGVjaG8gLWUgIiAgICAkKEFycmF5Ojp3cmFwICIgIiA3NiA0ICIke2hlbHBBcnJheVtAXX0iKSIKICAgIGVjaG8KICAgIGVjaG8gLW4gLWUgIiR7X19IRUxQX1RJVExFX0NPTE9SfVZFUlNJT046ICR7X19SRVNFVF9DT0xPUn0iCiAgICBlY2hvICcxLjAnCiAgICBlY2hvCiAgICBlY2hvIC1lICIke19fSEVMUF9USVRMRV9DT0xPUn1BVVRIT1I6JHtfX1JFU0VUX0NPTE9SfSIKICAgIGVjaG8gJ1tGcmFuw6dvaXMgQ2hhc3RhbmV0XShodHRwczovL2dpdGh1Yi5jb20vZmNoYXN0YW5ldCknCiAgICBlY2hvCiAgICBlY2hvIC1lICIke19fSEVMUF9USVRMRV9DT0xPUn1TT1VSQ0UgRklMRToke19fUkVTRVRfQ09MT1J9IgogICAgZWNobyAnaHR0cHM6Ly9naXRodWIuY29tL2ZjaGFzdGFuZXQvYmFzaC10b29scy1mcmFtZXdvcmsvdHJlZS9tYXN0ZXIvc3JjL19iaW5hcmllcy9idWlsZFB1c2hEb2NrZXJJbWFnZS5zaCcKICAgIGVjaG8KICAgIGVjaG8gLWUgIiR7X19IRUxQX1RJVExFX0NPTE9SfUxJQ0VOU0U6JHtfX1JFU0VUX0NPTE9SfSIKICAgIGVjaG8gJ01JVCBMaWNlbnNlJwogICAgZWNobwogICAgQXJyYXk6OndyYXAgJyAnIDc2IDQgIiQoY29weXJpZ2h0Q2FsbGJhY2spIgogIGVsc2UKICAgIExvZzo6ZGlzcGxheUVycm9yICJDb21tYW5kICR7U0NSSVBUX05BTUV9IC0gT3B0aW9uIGNvbW1hbmQgaW52YWxpZDogJyR7b3B0aW9uc19wYXJzZV9jbWR9JyIKICAgIHJldHVybiAxCiAgZmkKfQpkZWNsYXJlIGNvcHlyaWdodEJlZ2luWWVhcj0iMjAyMyIKCmJ1aWxkUHVzaERvY2tlckltYWdlQ29tbWFuZCBwYXJzZSAiJHtCQVNIX0ZSQU1FV09SS19BUkdWW0BdfSIKCiMgYnVpbGQgaW1hZ2UgYW5kIHB1c2ggaXQgb3QgcmVnaXN0cnkKcnVuKCkgewogIERPQ0tFUl9CVUlMRF9PUFRJT05TPSIke0RPQ0tFUl9CVUlMRF9PUFRJT05TOi19IgogICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjE1NAogIGxvY2FsIGltYWdlVGFnPSJidWlsZDpiYXNoLXRvb2xzLSR7b3B0aW9uVmVuZG9yfS0ke29wdGlvbkJhc2hWZXJzaW9ufSIKICBsb2NhbCBpbWFnZT0ic2NyYXNudXBzLyR7aW1hZ2VUYWd9IgoKICBMb2c6OmRpc3BsYXlJbmZvICJQdWxsIGltYWdlICR7aW1hZ2V9IgogICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjE1NAogICgKICAgIGlmIFtbICIke29wdGlvblRyYWNlVmVyYm9zZX0iID0gIjEiIF1dOyB0aGVuCiAgICAgIHNldCAteAogICAgZmkKICAgIGRvY2tlciBwdWxsICIke2ltYWdlfSIgfHwgdHJ1ZQogICkKCiAgTG9nOjpkaXNwbGF5SW5mbyAiQnVpbGQgaW1hZ2UgJHtpbWFnZX0iCiAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMDg2LFNDMjE1NAogICgKICAgICMgc2hlbGxjaGVjayBkaXNhYmxlPVNDMjE1NAogICAgaWYgW1sgIiR7b3B0aW9uVHJhY2VWZXJib3NlfSIgPSAiMSIgXV07IHRoZW4KICAgICAgc2V0IC14CiAgICBmaQogICAgRE9DS0VSX0JVSUxES0lUPTEgZG9ja2VyIGJ1aWxkIFwKICAgICAgJHtET0NLRVJfQlVJTERfT1BUSU9OU30gXAogICAgICAtZiAiJHtGUkFNRVdPUktfUk9PVF9ESVJ9Ly5kb2NrZXIvRG9ja2VyZmlsZS4ke29wdGlvblZlbmRvcn0iIFwKICAgICAgLS1jYWNoZS1mcm9tICIke2ltYWdlfSIgXAogICAgICAtLWJ1aWxkLWFyZyBCVUlMREtJVF9JTkxJTkVfQ0FDSEU9MSBcCiAgICAgIC0tYnVpbGQtYXJnIGFyZ0Jhc2hWZXJzaW9uPSIke29wdGlvbkJhc2hWZXJzaW9ufSIgXAogICAgICAtLWJ1aWxkLWFyZyBCQVNIX0lNQUdFPSIke29wdGlvbkJhc2hCYXNlSW1hZ2V9IiBcCiAgICAgIC10ICIke2ltYWdlVGFnfSIgXAogICAgICAtdCAiJHtpbWFnZX0iIFwKICAgICAgIiR7RlJBTUVXT1JLX1JPT1RfRElSfS8uZG9ja2VyIgogICkKCiAgTG9nOjpkaXNwbGF5SW5mbyAiSW1hZ2UgJHtpbWFnZX0gLSBiYXNoIHZlcnNpb24gY2hlY2siCiAgZG9ja2VyIHJ1biAtLXJtICIke2ltYWdlVGFnfSIgYmFzaCAtLXZlcnNpb24KCiAgIyBzaGVsbGNoZWNrIGRpc2FibGU9U0MyMTU0CiAgaWYgW1sgIiR7b3B0aW9uUHVzaH0iID0gIjEiIF1dOyB0aGVuCiAgICBMb2c6OmRpc3BsYXlJbmZvICJQdXNoIGltYWdlICR7aW1hZ2V9IgogICAgKAogICAgICBpZiBbWyAiJHtvcHRpb25UcmFjZVZlcmJvc2V9IiA9ICIxIiBdXTsgdGhlbgogICAgICAgIHNldCAteAogICAgICBmaQogICAgICBkb2NrZXIgcHVzaCAic2NyYXNudXBzLyR7aW1hZ2VUYWd9IgogICAgKQogIGZpCn0KCmlmIFtbICIke0JBU0hfRlJBTUVXT1JLX1FVSUVUX01PREU6LTB9IiA9ICIxIiBdXTsgdGhlbgogIHJ1biAmPi9kZXYvbnVsbAplbHNlCiAgcnVuCmZpCgp9CgpmYWNhZGVfbWFpbl9idWlsZFB1c2hEb2NrZXJJbWFnZXNoICIkQCIK" "755"

declare -gx embed_file_buildPushDockerImage="${PERSISTENT_TMPDIR:-/tmp}/c99752b27d9c27add2df540725abcf0e/buildPushDockerImage"

facade_main_runBuildContainersh() {
FRAMEWORK_ROOT_DIR="$(cd "${CURRENT_DIR}/.." && pwd -P)"
FRAMEWORK_SRC_DIR="${FRAMEWORK_ROOT_DIR}/src"
FRAMEWORK_BIN_DIR="${FRAMEWORK_ROOT_DIR}/bin"
FRAMEWORK_VENDOR_DIR="${FRAMEWORK_ROOT_DIR}/vendor"
FRAMEWORK_VENDOR_BIN_DIR="${FRAMEWORK_ROOT_DIR}/vendor/bin"
# REQUIRES
Env::requireLoad
UI::requireTheme
Log::requireLoad
Compiler::Facade::requireCommandBinDir

# @require Compiler::Facade::requireCommandBinDir

declare -a BASH_FRAMEWORK_ARGV_FILTERED=()

copyrightCallback() {
  if [[ -z "${copyrightBeginYear}" ]]; then
    copyrightBeginYear="$(date +%Y)"
  fi
  echo "Copyright (c) ${copyrightBeginYear}-now François Chastanet"
}

# shellcheck disable=SC2317 # if function is overridden
updateArgListInfoVerboseCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=(--verbose)
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListDebugVerboseCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=(-vv)
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListTraceVerboseCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=(-vvv)
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListEnvFileCallback() { :; }
# shellcheck disable=SC2317 # if function is overridden
updateArgListLogLevelCallback() { :; }
# shellcheck disable=SC2317 # if function is overridden
updateArgListDisplayLevelCallback() { :; }
# shellcheck disable=SC2317 # if function is overridden
updateArgListNoColorCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=(--no-color)
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListThemeCallback() { :; }
# shellcheck disable=SC2317 # if function is overridden
updateArgListQuietCallback() { :; }

# shellcheck disable=SC2317 # if function is overridden
optionHelpCallback() {
  runBuildContainerCommand help
  exit 0
}

# shellcheck disable=SC2317 # if function is overridden
optionVersionCallback() {
  echo "${SCRIPT_NAME} version 1.0"
  exit 0
}

# shellcheck disable=SC2317 # if function is overridden
optionEnvFileCallback() {
  local envFile="$2"
  Log::displayWarning "Command ${SCRIPT_NAME} - Option --env-file is deprecated and will be removed in the future"
  if [[ ! -f "${envFile}" || ! -r "${envFile}" ]]; then
    Log::displayError "Command ${SCRIPT_NAME} - Option --env-file - File '${envFile}' doesn't exist"
    exit 1
  fi
}

# shellcheck disable=SC2317 # if function is overridden
optionInfoVerboseCallback() {
  BASH_FRAMEWORK_ARGS_VERBOSE_OPTION='--verbose'
  BASH_FRAMEWORK_ARGS_VERBOSE=${__VERBOSE_LEVEL_INFO}
  BASH_FRAMEWORK_DISPLAY_LEVEL=${__LEVEL_INFO}
}

# shellcheck disable=SC2317 # if function is overridden
optionDebugVerboseCallback() {
  BASH_FRAMEWORK_ARGS_VERBOSE_OPTION='-vv'
  BASH_FRAMEWORK_ARGS_VERBOSE=${__VERBOSE_LEVEL_DEBUG}
  BASH_FRAMEWORK_DISPLAY_LEVEL=${__LEVEL_DEBUG}
}

# shellcheck disable=SC2317 # if function is overridden
optionTraceVerboseCallback() {
  BASH_FRAMEWORK_ARGS_VERBOSE_OPTION='-vvv'
  BASH_FRAMEWORK_ARGS_VERBOSE=${__VERBOSE_LEVEL_TRACE}
  BASH_FRAMEWORK_DISPLAY_LEVEL=${__LEVEL_DEBUG}
}

getLevel() {
  local levelName="$1"
  case "${levelName^^}" in
    OFF)
      echo "${__LEVEL_OFF}"
      ;;
    ERROR)
      echo "${__LEVEL_ERROR}"
      ;;
    WARNING)
      echo "${__LEVEL_WARNING}"
      ;;
    INFO)
      echo "${__LEVEL_INFO}"
      ;;
    DEBUG | TRACE)
      echo "${__LEVEL_DEBUG}"
      ;;
    *)
      Log::displayError "Command ${SCRIPT_NAME} - Invalid level ${level}"
      return 1
  esac
}

getVerboseLevel() {
  local levelName="$1"
  case "${levelName^^}" in
    OFF)
      echo "${__VERBOSE_LEVEL_OFF}"
      ;;
    ERROR | WARNING | INFO)
      echo "${__VERBOSE_LEVEL_INFO}"
      ;;
    DEBUG)
      echo "${__VERBOSE_LEVEL_DEBUG}"
      ;;
    TRACE)
      echo "${__VERBOSE_LEVEL_TRACE}"
      ;;
    *)
      Log::displayError "Command ${SCRIPT_NAME} - Invalid level ${level}"
      return 1
  esac
}

# shellcheck disable=SC2317 # if function is overridden
optionDisplayLevelCallback() {
  local level="$2"
  local logLevel verboseLevel
  logLevel="$(getLevel "${level}")"
  verboseLevel="$(getVerboseLevel "${level}")"
  BASH_FRAMEWORK_ARGS_VERBOSE=${verboseLevel}
  BASH_FRAMEWORK_DISPLAY_LEVEL=${logLevel}
}

# shellcheck disable=SC2317 # if function is overridden
optionLogLevelCallback() {
  local level="$2"
  local logLevel verboseLevel
  logLevel="$(getLevel "${level}")"
  verboseLevel="$(getVerboseLevel "${level}")"
  BASH_FRAMEWORK_ARGS_VERBOSE=${verboseLevel}
  BASH_FRAMEWORK_LOG_LEVEL=${logLevel}
}

# shellcheck disable=SC2317 # if function is overridden
optionLogFileCallback() {
  local logFile="$2"
  BASH_FRAMEWORK_LOG_FILE="${logFile}"
}

# shellcheck disable=SC2317 # if function is overridden
optionQuietCallback() {
  BASH_FRAMEWORK_QUIET_MODE=1
}

# shellcheck disable=SC2317 # if function is overridden
optionNoColorCallback() {
  UI::theme "noColor"
}

# shellcheck disable=SC2317 # if function is overridden
optionThemeCallback() {
  UI::theme "$2"
}

displayConfig() {
  echo "Config"
  UI::drawLine "-"
  local var
  while read -r var; do
    printf '%-40s = %s\n' "${var}" "$(declare -p "${var}" | sed -E -e 's/^[^=]+=(.*)/\1/')"
  done < <(typeset -p | awk 'match($3, "^(BASH_FRAMEWORK_[^=]+)=", m) { print m[1] }' | sort)
  exit 0
}

optionBashFrameworkConfigCallback() {
  if [[ ! -f "$2" ]]; then
    Log::fatal "Command ${SCRIPT_NAME} - Bash framework config file '$2' does not exists"
  fi
}

defaultFrameworkConfig="$(
  cat <<'EOF'
# copied from src/_includes/.framework-config.default
# shellcheck disable=SC2034

REAL_SCRIPT_FILE="${REAL_SCRIPT_FILE:-$(readlink -e "$(realpath "${BASH_SOURCE[0]}")")}"
FRAMEWORK_ROOT_DIR="${FRAMEWORK_ROOT_DIR:-$(cd "$(readlink -e "${REAL_SCRIPT_FILE%/*}")/../.." && pwd -P)}"
FRAMEWORK_SRC_DIR="${FRAMEWORK_SRC_DIR:-${FRAMEWORK_ROOT_DIR}/src}"
FRAMEWORK_BIN_DIR="${FRAMEWORK_BIN_DIR:-${FRAMEWORK_ROOT_DIR}/bin}"
FRAMEWORK_VENDOR_DIR="${FRAMEWORK_VENDOR_DIR:-${FRAMEWORK_ROOT_DIR}/vendor}"
FRAMEWORK_VENDOR_BIN_DIR="${FRAMEWORK_VENDOR_BIN_DIR:-${FRAMEWORK_ROOT_DIR}/vendor/bin}"

# describe the functions that will be skipped from being imported
FRAMEWORK_FUNCTIONS_IGNORE_REGEXP="${FRAMEWORK_FUNCTIONS_IGNORE_REGEXP:-^(Namespace::functions|Functions::myFunction|Namespace::requireSomething|Acquire::ForceIPv4)$}"
# describe the files that do not contain function to be imported
NON_FRAMEWORK_FILES_REGEXP="${NON_FRAMEWORK_FILES_REGEXP:-(^bin/|.framework-config|.bats$|/testsData/|^manualTests/|/_.sh$|/ZZZ.sh$|/__all.sh$|^src/_binaries|^src/_includes|^src/batsHeaders.sh$|^src/_standalone)}"
# describe the files that are allowed to not have an associated bats file
BATS_FILE_NOT_NEEDED_REGEXP="${BATS_FILE_NOT_NEEDED_REGEXP:-(^bin/|.framework-config|.bats$|/testsData/|^manualTests/|/_.sh$|/ZZZ.sh$|/__all.sh$|^src/batsHeaders.sh$|^src/_includes)}"
# describe the files that are allowed to not have a function matching the filename
FRAMEWORK_FILES_FUNCTION_MATCHING_IGNORE_REGEXP="${FRAMEWORK_FILES_FUNCTION_MATCHING_IGNORE_REGEXP:-^bin/|^\.framework-config$|^build.sh$|\.tpl$|/testsData/|^manualTests/|\.bats$}"
# Source directories
if [[ ! -v FRAMEWORK_SRC_DIRS ]]; then
  FRAMEWORK_SRC_DIRS=(
    "${FRAMEWORK_ROOT_DIR}/src"
  )
fi

# export here all the variables that will be used in your templates
export REPOSITORY_URL="${REPOSITORY_URL:-https://github.com/fchastanet/bash-tools-framework}"

BASH_FRAMEWORK_THEME="${BASH_FRAMEWORK_THEME:-default}"
BASH_FRAMEWORK_LOG_LEVEL="${BASH_FRAMEWORK_LOG_LEVEL:-0}"
BASH_FRAMEWORK_DISPLAY_LEVEL="${BASH_FRAMEWORK_DISPLAY_LEVEL:-3}"
BASH_FRAMEWORK_LOG_FILE="${BASH_FRAMEWORK_LOG_FILE:-${FRAMEWORK_ROOT_DIR}/logs/$(basename "$0").log}"
BASH_FRAMEWORK_LOG_FILE_MAX_ROTATION="${BASH_FRAMEWORK_LOG_FILE_MAX_ROTATION:-5}"
EOF
)"

commandOptionParseFinished() {
  # load default template framework config
  # shellcheck disable=SC2034
  defaultEnvFile="${PERSISTENT_TMPDIR}/.framework-config"
  echo "${defaultFrameworkConfig}" > "${defaultEnvFile}"

  Env::requireLoad "${defaultEnvFile}"
  Log::requireLoad

  if [[ "${optionConfig}" = "1" ]]; then
    displayConfig
  fi
}

# shellcheck disable=SC2317 # if function is overridden
updateOptionVendorCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=("$1" "$2")
}

# shellcheck disable=SC2317 # if function is overridden
updateOptionBashVersionCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=("$1" "$2")
}

# shellcheck disable=SC2317 # if function is overridden
updateOptionBashBaseImageCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=("$1" "$2")
}

# shellcheck disable=SC2317 # if function is overridden
updateOptionBranchNameCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=("$1" "$2")
}

declare optionVendor="ubuntu"
declare optionBashVersion="5.1"
declare optionBashBaseImage="ubuntu:20.04"
declare optionContinuousIntegrationMode=0

# shellcheck disable=SC2317 # if function is overridden
updateOptionContinuousIntegrationMode() {
  BASH_FRAMEWORK_ARGV_FILTERED+=("$1")
}

declare optionSkipDockerBuild=0

# shellcheck disable=SC2317 # if function is overridden
updateOptionSkipDockerBuildCallback() {
  BASH_FRAMEWORK_ARGV_FILTERED+=("$1")
}

runBuildContainerCommand() {
  local options_parse_cmd="$1"
  shift || true

  if [[ "${options_parse_cmd}" = "parse" ]]; then
    local -i options_parse_optionParsedCountOptionVendor
    ((options_parse_optionParsedCountOptionVendor = 0)) || true
    local -i options_parse_optionParsedCountOptionBashVersion
    ((options_parse_optionParsedCountOptionBashVersion = 0)) || true
    local -i options_parse_optionParsedCountOptionBashBaseImage
    ((options_parse_optionParsedCountOptionBashBaseImage = 0)) || true
    local -i options_parse_optionParsedCountOptionBranchName
    ((options_parse_optionParsedCountOptionBranchName = 0)) || true
    optionContinuousIntegrationMode="0"
    local -i options_parse_optionParsedCountOptionContinuousIntegrationMode
    ((options_parse_optionParsedCountOptionContinuousIntegrationMode = 0)) || true
    optionSkipDockerBuild="0"
    local -i options_parse_optionParsedCountOptionSkipDockerBuild
    ((options_parse_optionParsedCountOptionSkipDockerBuild = 0)) || true
    local -i options_parse_optionParsedCountOptionBashFrameworkConfig
    ((options_parse_optionParsedCountOptionBashFrameworkConfig = 0)) || true
    optionConfig="0"
    local -i options_parse_optionParsedCountOptionConfig
    ((options_parse_optionParsedCountOptionConfig = 0)) || true
    optionInfoVerbose="0"
    local -i options_parse_optionParsedCountOptionInfoVerbose
    ((options_parse_optionParsedCountOptionInfoVerbose = 0)) || true
    optionDebugVerbose="0"
    local -i options_parse_optionParsedCountOptionDebugVerbose
    ((options_parse_optionParsedCountOptionDebugVerbose = 0)) || true
    optionTraceVerbose="0"
    local -i options_parse_optionParsedCountOptionTraceVerbose
    ((options_parse_optionParsedCountOptionTraceVerbose = 0)) || true
    optionNoColor="0"
    local -i options_parse_optionParsedCountOptionNoColor
    ((options_parse_optionParsedCountOptionNoColor = 0)) || true
    local -i options_parse_optionParsedCountOptionTheme
    ((options_parse_optionParsedCountOptionTheme = 0)) || true
    optionHelp="0"
    local -i options_parse_optionParsedCountOptionHelp
    ((options_parse_optionParsedCountOptionHelp = 0)) || true
    optionVersion="0"
    local -i options_parse_optionParsedCountOptionVersion
    ((options_parse_optionParsedCountOptionVersion = 0)) || true
    optionQuiet="0"
    local -i options_parse_optionParsedCountOptionQuiet
    ((options_parse_optionParsedCountOptionQuiet = 0)) || true
    local -i options_parse_optionParsedCountOptionLogLevel
    ((options_parse_optionParsedCountOptionLogLevel = 0)) || true
    local -i options_parse_optionParsedCountOptionLogFile
    ((options_parse_optionParsedCountOptionLogFile = 0)) || true
    local -i options_parse_optionParsedCountOptionDisplayLevel
    ((options_parse_optionParsedCountOptionDisplayLevel = 0)) || true
    local -i options_parse_argParsedCountDockerRunCmd
    ((options_parse_argParsedCountDockerRunCmd = 0)) || true
    # shellcheck disable=SC2034
    local -i options_parse_parsedArgIndex=0
    while (($# > 0)); do
      local options_parse_arg="$1"
      local argOptDefaultBehavior=0
      case "${options_parse_arg}" in
        # Option 1/20
        # Option optionVendor --vendor variableType String min 0 max 1 authorizedValues 'alpine|ubuntu' regexp ''
        --vendor)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if [[ ! "$1" =~ alpine|ubuntu ]]; then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - value '$1' is not part of authorized values(alpine|ubuntu)"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionVendor >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionVendor))
          # shellcheck disable=SC2034
          optionVendor="$1"
          updateOptionVendorCallback "${options_parse_arg}" "${optionVendor}"
          ;;
        # Option 2/20
        # Option optionBashVersion --bash-version variableType String min 0 max 1 authorizedValues '4.4|5.0|5.1|5.2' regexp ''
        --bash-version)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if [[ ! "$1" =~ 4.4|5.0|5.1|5.2 ]]; then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - value '$1' is not part of authorized values(4.4|5.0|5.1|5.2)"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionBashVersion >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionBashVersion))
          # shellcheck disable=SC2034
          optionBashVersion="$1"
          updateOptionBashVersionCallback "${options_parse_arg}" "${optionBashVersion}"
          ;;
        # Option 3/20
        # Option optionBashBaseImage --bash-base-image variableType String min 0 max 1 authorizedValues '' regexp ''
        --bash-base-image)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionBashBaseImage >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionBashBaseImage))
          # shellcheck disable=SC2034
          optionBashBaseImage="$1"
          updateOptionBashBaseImageCallback "${options_parse_arg}" "${optionBashBaseImage}"
          ;;
        # Option 4/20
        # Option optionBranchName --branch-name variableType String min 0 max 1 authorizedValues '' regexp ''
        --branch-name)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionBranchName >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionBranchName))
          # shellcheck disable=SC2034
          optionBranchName="$1"
          updateOptionBranchNameCallback "${options_parse_arg}" "${optionBranchName}"
          ;;
        # Option 5/20
        # Option optionContinuousIntegrationMode --ci variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --ci)
          # shellcheck disable=SC2034
          optionContinuousIntegrationMode="1"
          if ((options_parse_optionParsedCountOptionContinuousIntegrationMode >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionContinuousIntegrationMode))
          updateOptionContinuousIntegrationMode "${options_parse_arg}"
          ;;
        # Option 6/20
        # Option optionSkipDockerBuild --skip-docker-build variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --skip-docker-build)
          # shellcheck disable=SC2034
          optionSkipDockerBuild="1"
          if ((options_parse_optionParsedCountOptionSkipDockerBuild >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionSkipDockerBuild))
          updateOptionSkipDockerBuildCallback "${options_parse_arg}"
          ;;
        # Option 7/20
        # Option optionBashFrameworkConfig --bash-framework-config variableType String min 0 max 1 authorizedValues '' regexp ''
        --bash-framework-config)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionBashFrameworkConfig >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionBashFrameworkConfig))
          # shellcheck disable=SC2034
          optionBashFrameworkConfig="$1"
          optionBashFrameworkConfigCallback "${options_parse_arg}" "${optionBashFrameworkConfig}"
          ;;
        # Option 8/20
        # Option optionConfig --config variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --config)
          # shellcheck disable=SC2034
          optionConfig="1"
          if ((options_parse_optionParsedCountOptionConfig >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionConfig))
          ;;
        # Option 9/20
        # Option optionInfoVerbose --verbose|-v variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --verbose | -v)
          # shellcheck disable=SC2034
          optionInfoVerbose="1"
          if ((options_parse_optionParsedCountOptionInfoVerbose >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionInfoVerbose))
          optionInfoVerboseCallback "${options_parse_arg}"
          updateArgListInfoVerboseCallback "${options_parse_arg}"
          ;;
        # Option 10/20
        # Option optionDebugVerbose -vv variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        -vv)
          # shellcheck disable=SC2034
          optionDebugVerbose="1"
          if ((options_parse_optionParsedCountOptionDebugVerbose >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionDebugVerbose))
          optionDebugVerboseCallback "${options_parse_arg}"
          updateArgListDebugVerboseCallback "${options_parse_arg}"
          ;;
        # Option 11/20
        # Option optionTraceVerbose -vvv variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        -vvv)
          # shellcheck disable=SC2034
          optionTraceVerbose="1"
          if ((options_parse_optionParsedCountOptionTraceVerbose >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionTraceVerbose))
          optionTraceVerboseCallback "${options_parse_arg}"
          updateArgListTraceVerboseCallback "${options_parse_arg}"
          ;;
        # Option 12/20
        # Option optionEnvFiles --env-file variableType StringArray min 0 max -1 authorizedValues '' regexp ''
        --env-file)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionEnvFiles))
          optionEnvFiles+=("$1")
          optionEnvFileCallback "${options_parse_arg}" "${optionEnvFiles[@]}"
          updateArgListEnvFileCallback "${options_parse_arg}" "${optionEnvFiles[@]}"
          ;;
        # Option 13/20
        # Option optionNoColor --no-color variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --no-color)
          # shellcheck disable=SC2034
          optionNoColor="1"
          if ((options_parse_optionParsedCountOptionNoColor >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionNoColor))
          optionNoColorCallback "${options_parse_arg}"
          updateArgListNoColorCallback "${options_parse_arg}"
          ;;
        # Option 14/20
        # Option optionTheme --theme variableType String min 0 max 1 authorizedValues 'default|default-force|noColor' regexp ''
        --theme)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if [[ ! "$1" =~ default|default-force|noColor ]]; then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - value '$1' is not part of authorized values(default|default-force|noColor)"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionTheme >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionTheme))
          # shellcheck disable=SC2034
          optionTheme="$1"
          optionThemeCallback "${options_parse_arg}" "${optionTheme}"
          updateArgListThemeCallback "${options_parse_arg}" "${optionTheme}"
          ;;
        # Option 15/20
        # Option optionHelp --help|-h variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --help | -h)
          # shellcheck disable=SC2034
          optionHelp="1"
          if ((options_parse_optionParsedCountOptionHelp >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionHelp))
          optionHelpCallback "${options_parse_arg}"
          ;;
        # Option 16/20
        # Option optionVersion --version variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --version)
          # shellcheck disable=SC2034
          optionVersion="1"
          if ((options_parse_optionParsedCountOptionVersion >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionVersion))
          optionVersionCallback "${options_parse_arg}"
          ;;
        # Option 17/20
        # Option optionQuiet --quiet|-q variableType Boolean min 0 max 1 authorizedValues '' regexp ''
        --quiet | -q)
          # shellcheck disable=SC2034
          optionQuiet="1"
          if ((options_parse_optionParsedCountOptionQuiet >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionQuiet))
          optionQuietCallback "${options_parse_arg}"
          updateArgListQuietCallback "${options_parse_arg}"
          ;;
        # Option 18/20
        # Option optionLogLevel --log-level variableType String min 0 max 1 authorizedValues 'OFF|ERROR|WARNING|INFO|DEBUG|TRACE' regexp ''
        --log-level)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if [[ ! "$1" =~ OFF|ERROR|WARNING|INFO|DEBUG|TRACE ]]; then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - value '$1' is not part of authorized values(OFF|ERROR|WARNING|INFO|DEBUG|TRACE)"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionLogLevel >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionLogLevel))
          # shellcheck disable=SC2034
          optionLogLevel="$1"
          optionLogLevelCallback "${options_parse_arg}" "${optionLogLevel}"
          updateArgListLogLevelCallback "${options_parse_arg}" "${optionLogLevel}"
          ;;
        # Option 19/20
        # Option optionLogFile --log-file variableType String min 0 max 1 authorizedValues '' regexp ''
        --log-file)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionLogFile >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionLogFile))
          # shellcheck disable=SC2034
          optionLogFile="$1"
          optionLogFileCallback "${options_parse_arg}" "${optionLogFile}"
          updateArgListLogFileCallback "${options_parse_arg}" "${optionLogFile}"
          ;;
        # Option 20/20
        # Option optionDisplayLevel --display-level variableType String min 0 max 1 authorizedValues 'OFF|ERROR|WARNING|INFO|DEBUG|TRACE' regexp ''
        --display-level)
          shift
          if (($# == 0)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - a value needs to be specified"
            return 1
          fi
          if [[ ! "$1" =~ OFF|ERROR|WARNING|INFO|DEBUG|TRACE ]]; then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - value '$1' is not part of authorized values(OFF|ERROR|WARNING|INFO|DEBUG|TRACE)"
            return 1
          fi
          if ((options_parse_optionParsedCountOptionDisplayLevel >= 1)); then
            Log::displayError "Command ${SCRIPT_NAME} - Option ${options_parse_arg} - Maximum number of option occurrences reached(1)"
            return 1
          fi
          ((++options_parse_optionParsedCountOptionDisplayLevel))
          # shellcheck disable=SC2034
          optionDisplayLevel="$1"
          optionDisplayLevelCallback "${options_parse_arg}" "${optionDisplayLevel}"
          updateArgListDisplayLevelCallback "${options_parse_arg}" "${optionDisplayLevel}"
          ;;
        -*)
          unknownOption "${options_parse_arg}"
          ;;
        *)
          if ((0)); then
            # Technical if - never reached
            :
          # Argument 1/1
          # Argument dockerRunCmd min 0 max -1 authorizedValues '' regexp ''
          elif ((options_parse_parsedArgIndex >= 0)); then
            ((++options_parse_argParsedCountDockerRunCmd))
            # shellcheck disable=SC2034
            dockerRunCmd+=("${options_parse_arg}")
          else
            if [[ "${argOptDefaultBehavior}" = "0" ]]; then
              Log::displayError "Command ${SCRIPT_NAME} - Argument - too much arguments provided: $*"
              return 1
            fi
          fi
          ((++options_parse_parsedArgIndex))
          ;;
      esac
      shift || true
    done
    commandOptionParseFinished
    Log::displayDebug "Command ${SCRIPT_NAME} - parse arguments: ${BASH_FRAMEWORK_ARGV[*]}"
    Log::displayDebug "Command ${SCRIPT_NAME} - parse filtered arguments: ${BASH_FRAMEWORK_ARGV_FILTERED[*]}"
  elif [[ "${options_parse_cmd}" = "help" ]]; then
    echo -e "$(Array::wrap " " 80 0 "${__HELP_TITLE_COLOR}DESCRIPTION:${__RESET_COLOR}" "run the container eventually building the docker image before.")"
    echo

    echo -e "$(Array::wrap " " 80 2 "${__HELP_TITLE_COLOR}USAGE:${__RESET_COLOR}" "${SCRIPT_NAME}" "[OPTIONS]" "[ARGUMENTS]")"
    echo -e "$(Array::wrap " " 80 2 "${__HELP_TITLE_COLOR}USAGE:${__RESET_COLOR}" \
      "${SCRIPT_NAME}" \
      "[--vendor <String>]" "[--bash-version <String>]" "[--bash-base-image <String>]" "[--branch-name <String>]" "[--ci]" "[--skip-docker-build]" "[--bash-framework-config <String>]" "[--config]" "[--verbose|-v]" "[-vv]" "[-vvv]" "[--env-file <String>]" "[--no-color]" "[--theme <String>]" "[--help|-h]" "[--version]" "[--quiet|-q]" "[--log-level <String>]" "[--log-file <String>]" "[--display-level <String>]")"
    echo
    echo -e "${__HELP_TITLE_COLOR}ARGUMENTS:${__RESET_COLOR}"
    echo -e "  [${__HELP_OPTION_COLOR}arg${__HELP_NORMAL} {list} (optional)]"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(command\ arguments\ including\ command\ name)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo
    echo -e "${__HELP_TITLE_COLOR}OPTIONS:${__RESET_COLOR}"
    echo -e "  ${__HELP_OPTION_COLOR}--vendor <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(vendor\ image\ to\ use:\ alpine\|ubuntu\ \(Default:\ ubuntu\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--bash-version <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(version\ of\ bash\ to\ use:\ 4.4\|5.0\|5.1\|5.2\ \(Default:\ 5.1\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--bash-base-image <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(bash\ bash\ image\ to\ use\ \(eg:\ ubuntu:20.04\,\ amd64/bash:4.4-alpine3.18\)\ \(Default:\ ubuntu:20.04\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--branch-name <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(branch\ name\ being\ built\,\ will\ help\ to\ create\ docker\ image\ tag\ name)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--ci${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(activate\ continuous\ integration\ mode\ \(tmp\ folder\ not\ shared\ with\ host\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--skip-docker-build${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(skip\ docker\ image\ build\ if\ option\ provided)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo
    echo -e "${__HELP_TITLE_COLOR}GLOBAL OPTIONS:${__RESET_COLOR}"
    echo -e "  ${__HELP_OPTION_COLOR}--bash-framework-config <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(use\ alternate\ bash\ framework\ configuration.)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--config${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Display\ configuration)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--verbose${__HELP_NORMAL}, ${__HELP_OPTION_COLOR}-v${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(info\ level\ verbose\ mode\ \(alias\ of\ --display-level\ INFO\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}-vv${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(debug\ level\ verbose\ mode\ \(alias\ of\ --display-level\ DEBUG\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}-vvv${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(trace\ level\ verbose\ mode\ \(alias\ of\ --display-level\ TRACE\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--env-file <String>${__HELP_NORMAL} {list} (optional)"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Load\ the\ specified\ env\ file\ \(deprecated\,\ please\ use\ --bash-framework-config\ option\ instead\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--no-color${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Produce\ monochrome\ output.\ alias\ of\ --theme\ noColor.)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--theme <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(choose\ color\ theme\ \(default\,\ default-force\ or\ noColor\)\ -\ default-force\ means\ colors\ will\ be\ produced\ even\ if\ command\ is\ piped)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--help${__HELP_NORMAL}, ${__HELP_OPTION_COLOR}-h${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Display\ this\ command\ help)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--version${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Print\ version\ information\ and\ quit)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--quiet${__HELP_NORMAL}, ${__HELP_OPTION_COLOR}-q${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(quiet\ mode\,\ doesn\'t\ display\ any\ output)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--log-level <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Set\ log\ level\ \(one\ of\ OFF\,\ ERROR\,\ WARNING\,\ INFO\,\ DEBUG\,\ TRACE\ value\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--log-file <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(Set\ log\ file)
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e "  ${__HELP_OPTION_COLOR}--display-level <String>${__HELP_NORMAL} {single}"
    local -a helpArray
    # shellcheck disable=SC2054
    helpArray=(set\ display\ level\ \(one\ of\ OFF\,\ ERROR\,\ WARNING\,\ INFO\,\ DEBUG\,\ TRACE\ value\))
    echo -e "    $(Array::wrap " " 76 4 "${helpArray[@]}")"
    echo -e """
run the container specified by args provided.
Command to run is passed via the rest of arguments.
TTY allocation is detected automatically.

additional env variables can be passed to docker build:
  - ${__HELP_OPTION_COLOR}SKIP_USER${__HELP_NORMAL} (default: 0)
  - ${__HELP_OPTION_COLOR}USER_ID${__HELP_NORMAL} (default: current user id provided by (id -u) command)
  - ${__HELP_OPTION_COLOR}GROUP_ID${__HELP_NORMAL} (default: current group id provided by (id -g) command)

additional docker run options can be passed
  via ${__HELP_OPTION_COLOR}DOCKER_RUN_OPTIONS${__HELP_NORMAL} env variable"""
    echo
    echo -n -e "${__HELP_TITLE_COLOR}VERSION: ${__RESET_COLOR}"
    echo '1.0'
    echo
    echo -e "${__HELP_TITLE_COLOR}AUTHOR:${__RESET_COLOR}"
    echo '[François Chastanet](https://github.com/fchastanet)'
    echo
    echo -e "${__HELP_TITLE_COLOR}SOURCE FILE:${__RESET_COLOR}"
    echo 'https://github.com/fchastanet/bash-tools-framework/tree/master/src/_binaries/runBuildContainer.sh'
    echo
    echo -e "${__HELP_TITLE_COLOR}LICENSE:${__RESET_COLOR}"
    echo 'MIT License'
    echo
    Array::wrap ' ' 76 4 "$(copyrightCallback)"
  else
    Log::displayError "Command ${SCRIPT_NAME} - Option command invalid: '${options_parse_cmd}'"
    return 1
  fi
}
declare copyrightBeginYear="2022"

# shellcheck disable=SC2317 # if function is overridden
unknownOption() {
  dockerRunCmd+=("$1")
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListInfoVerboseCallback() {
  RUN_CONTAINER_ARGV_FILTERED+=(--verbose)
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListDebugVerboseCallback() {
  RUN_CONTAINER_ARGV_FILTERED+=(-vv)
}
# shellcheck disable=SC2317 # if function is overridden
updateArgListTraceVerboseCallback() {
  RUN_CONTAINER_ARGV_FILTERED+=(-vvv)
}

declare -a dockerRunCmd=()
declare -a dockerRunArgs=()
declare -a dockerRunArgs=(
  -e KEEP_TEMP_FILES="${KEEP_TEMP_FILES}"
  -e BATS_FIX_TEST="${BATS_FIX_TEST:-0}"
)
export DOCKER_BUILD_OPTIONS="${DOCKER_BUILD_OPTIONS:-}"
export DOCKER_RUN_OPTIONS="${DOCKER_RUN_OPTIONS:-}"
export BASH_FRAMEWORK_ROOT_DIR="${FRAMEWORK_ROOT_DIR}"

runBuildContainerCommand parse "${BASH_FRAMEWORK_ARGV[@]}"

if tty -s; then
  dockerRunArgs+=("-it")
fi
if [[ -d "$(pwd)/vendor/bash-tools-framework" ]]; then
  BASH_FRAMEWORK_ROOT_DIR="$(cd "$(pwd)/vendor/bash-tools-framework" && pwd -P)"
  dockerRunArgs+=(
    -v "${BASH_FRAMEWORK_ROOT_DIR}:/bash/vendor/bash-tools-framework"
  )
fi

# shellcheck disable=SC2154
if [[ "${optionContinuousIntegrationMode}" = "0" ]]; then
  dockerRunArgs+=(-v "/tmp:/tmp")
fi

run() {
  # shellcheck disable=SC2154
  Log::displayInfo "Using ${optionVendor}:${optionBashVersion}"

  imageRef="bash-tools-${optionVendor}-${optionBashVersion}"
  if [[ "${optionSkipDockerBuild:-0}" != "1" ]]; then
    Log::displayInfo "Build docker image ${imageRef}"
    # shellcheck disable=SC2154
    (
      if [[ "${optionTraceVerbose}" = "1" ]]; then
        set -x
      fi
      EMBED_CURRENT_DIR="${CURRENT_DIR}" "${embed_file_buildPushDockerImage}" \
        --vendor "${optionVendor}" \
        --bash-version "${optionBashVersion}" \
        --bash-base-image "${optionBashBaseImage}" \
        "${RUN_CONTAINER_ARGV_FILTERED[@]}"
    )
  fi
  if [[ -f "${FRAMEWORK_ROOT_DIR}/.docker/DockerfileUser" ]]; then
    local imageRefUser="${imageRef}-user"
    if [[ "${optionSkipDockerBuild:-0}" != "1" ]]; then
      Log::displayInfo "build docker image ${imageRefUser} with user configuration"
      # shellcheck disable=SC2154
      (
        if [[ "${optionTraceVerbose}" = "1" ]]; then
          set -x
        fi
        # shellcheck disable=SC2086
        DOCKER_BUILDKIT=1 docker build \
          ${DOCKER_BUILD_OPTIONS} \
          --cache-from "scrasnups/build:${imageRef}" \
          --build-arg "BASH_IMAGE=scrasnups/build:${imageRef}" \
          --build-arg SKIP_USER="${SKIP_USER:-0}" \
          --build-arg USER_ID="${USER_ID:-$(id -u)}" \
          --build-arg GROUP_ID="${GROUP_ID:-$(id -g)}" \
          -f "${FRAMEWORK_ROOT_DIR}/.docker/DockerfileUser" \
          -t "${imageRefUser}" \
          "${FRAMEWORK_ROOT_DIR}/.docker"
      )
    fi
  fi

  Log::displayInfo "Run container with command: '${dockerRunCmd[*]} ${RUN_CONTAINER_ARGV_FILTERED[*]}'"
  (
    # shellcheck disable=SC2154
    if [[ "${optionTraceVerbose}" = "1" ]]; then
      set -x
    fi
    # shellcheck disable=SC2086
    docker run \
      --rm \
      ${DOCKER_RUN_OPTIONS} \
      "${dockerRunArgs[@]}" \
      -w /bash \
      -v "$(pwd):/bash" \
      --user "${USER_ID:-$(id -u)}:${GROUP_ID:-$(id -g)}" \
      "${imageRefUser}" \
      "${dockerRunCmd[@]}" \
      "${RUN_CONTAINER_ARGV_FILTERED[@]}"
  )
}

if [[ "${BASH_FRAMEWORK_QUIET_MODE:-0}" = "1" ]]; then
  run &>/dev/null
else
  run
fi

}

facade_main_runBuildContainersh "$@"
